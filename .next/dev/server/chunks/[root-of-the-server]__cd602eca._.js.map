{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/mouthworks_/app/api/payments/create/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\n\r\nconst isUuid = (value: any) => typeof value === \"string\" && /^[0-9a-fA-F-]{36}$/.test(value)\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseServiceRole = process.env.SUPABASE_SERVICE_ROLE || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const paymentData = await request.json()\r\n    \r\n    console.log(\"[v0] üíæ Server-side payment creation:\", paymentData)\r\n\r\n    if (!isUuid(paymentData?.dentist_id)) {\r\n      console.error(\"[v0] ‚ùå Invalid dentist_id provided:\", paymentData?.dentist_id)\r\n      return NextResponse.json({ error: \"Invalid dentist_id\" }, { status: 400 })\r\n    }\r\n\r\n    // Use service role client to bypass RLS\r\n    const supabase = createClient(supabaseUrl, supabaseServiceRole, {\r\n      auth: {\r\n        autoRefreshToken: false,\r\n        persistSession: false,\r\n      },\r\n    })\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"payments\")\r\n      .insert([paymentData])\r\n      .select(\"*, patients(name), dentists(name)\")\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[v0] ‚ùå Server payment creation failed:\", error)\r\n      return NextResponse.json({ error: error.message }, { status: 500 })\r\n    }\r\n\r\n    console.log(\"[v0] ‚úÖ Payment created successfully:\", data)\r\n    return NextResponse.json(data)\r\n  } catch (err) {\r\n    console.error(\"[v0] ‚ùå Server error:\", err)\r\n    return NextResponse.json(\r\n      { error: err instanceof Error ? err.message : \"Unknown error\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,CAAC,QAAe,OAAO,UAAU,YAAY,qBAAqB,IAAI,CAAC;AAEtF,MAAM;AACN,MAAM,sBAAsB,QAAQ,GAAG,CAAC,qBAAqB;AAEtD,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,cAAc,MAAM,QAAQ,IAAI;QAEtC,QAAQ,GAAG,CAAC,yCAAyC;QAErD,IAAI,CAAC,OAAO,aAAa,aAAa;YACpC,QAAQ,KAAK,CAAC,uCAAuC,aAAa;YAClE,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,wCAAwC;QACxC,MAAM,WAAW,IAAA,yMAAY,EAAC,aAAa,qBAAqB;YAC9D,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC;YAAC;SAAY,EACpB,MAAM,CAAC,qCACP,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0CAA0C;YACxD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,QAAQ,GAAG,CAAC,wCAAwC;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;QAAgB,GAC9D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}