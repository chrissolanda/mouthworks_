{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/laure/im_mouthworks/im_mouthworks/app/api/auth/update-password/route.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { email, password } = await request.json()\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json({ message: \"Email and password are required\" }, { status: 400 })\r\n    }\r\n\r\n    const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n\r\n    if (!serviceRoleKey || !supabaseUrl) {\r\n      console.error(\"Missing SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_URL\")\r\n      return NextResponse.json(\r\n        { message: \"Server not configured for user admin operations\" },\r\n        { status: 500 },\r\n      )\r\n    }\r\n\r\n    // Create a Supabase admin client using the service role key\r\n    const supabase = createClient(supabaseUrl, serviceRoleKey)\r\n\r\n    // Get the user list (the admin API may return { users: [...] } or an array depending on SDK version)\r\n    const { data, error: fetchError } = await supabase.auth.admin.listUsers()\r\n\r\n    if (fetchError) {\r\n      console.error(\"Error fetching users:\", fetchError)\r\n      return NextResponse.json({ message: \"Failed to fetch users\" }, { status: 500 })\r\n    }\r\n\r\n    const userList = Array.isArray(data) ? data : (data && (data as any).users) || []\r\n\r\n    const user = userList.find((u: any) => u.email === email)\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ message: \"User not found\" }, { status: 404 })\r\n    }\r\n\r\n    // Update the user password\r\n    const { data: updated, error: updateError } = await supabase.auth.admin.updateUserById(user.id, {\r\n      password,\r\n    })\r\n\r\n    if (updateError) {\r\n      console.error(\"Error updating password:\", updateError)\r\n      return NextResponse.json({ message: \"Failed to update password\" }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({ message: \"Password updated successfully\" }, { status: 200 })\r\n  } catch (error) {\r\n    console.error(\"Error in update-password API:\", error)\r\n    return NextResponse.json({ message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9C,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,kLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;QAC5D,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB;QAExD,IAAI,CAAC,kBAAkB,CAAC,aAAa;YACnC,QAAQ,KAAK,CAAC;YACd,OAAO,kLAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAkD,GAC7D;gBAAE,QAAQ;YAAI;QAElB;QAEA,4DAA4D;QAC5D,MAAM,WAAW,IAAA,2OAAY,EAAC,aAAa;QAE3C,qGAAqG;QACrG,MAAM,EAAE,IAAI,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,SAAS;QAEvE,IAAI,YAAY;YACd,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,kLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,WAAW,MAAM,OAAO,CAAC,QAAQ,OAAO,AAAC,QAAQ,AAAC,KAAa,KAAK,IAAK,EAAE;QAEjF,MAAM,OAAO,SAAS,IAAI,CAAC,CAAC,IAAW,EAAE,KAAK,KAAK;QAEnD,IAAI,CAAC,MAAM;YACT,OAAO,kLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,2BAA2B;QAC3B,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,KAAK,EAAE,EAAE;YAC9F;QACF;QAEA,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,OAAO,kLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,OAAO,kLAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACvF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,kLAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}