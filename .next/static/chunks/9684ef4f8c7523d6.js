(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},91432,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(3922);let i=(0,a.createContext)(void 0);function n({children:n}){let[o,s]=(0,a.useState)(null),[l,u]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{let t=(0,r.getSupabaseClient)(),{data:{user:a},error:i}=await t.auth.getUser();if(a&&!i){let t=a.email||"",r=a.user_metadata?.role||"patient",i=t.toLowerCase().endsWith("@gmail.com");if(s({id:a.id,email:t,name:a.user_metadata?.name||t||"",role:r,phone:a.user_metadata?.phone,specialization:a.user_metadata?.specialization}),"patient"===r&&i){d(!1),h(!0);try{let{patientService:r}=await e.A(24431);await r.getByEmail(t)||await r.create({name:a.user_metadata?.name||t,email:t,phone:a.user_metadata?.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record for Gmail user:",e)}}}}catch(e){console.error("[v0] Auth initialization error:",e)}u(!1)})()},[]);let p=async(t,a)=>{try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.from("auth_users").select("*").eq("email",t).maybeSingle();if(o&&console.warn("[v0] Supabase error checking auth_users:",o),n)if(n.password_hash===a){let t={id:n.id,email:n.email,name:n.name||n.email,role:n.role,phone:n.phone||void 0,specialization:n.specialization||void 0};s(t),localStorage.setItem("user",JSON.stringify(t));let a=(t.email||"").toLowerCase().endsWith("@gmail.com");if("patient"===t.role)if(a){d(!1),h(!0);try{let{patientService:a}=await e.A(24431);await a.getByEmail(t.email)||await a.create({name:t.name||t.email,email:t.email,phone:t.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after login:",e)}}else d(!0),h(!1);return}else throw Error("Invalid credentials")}catch(e){console.warn("[v0] Error authenticating against auth_users:",e)}try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.auth.signInWithPassword({email:t,password:a});if(o)console.warn("[v0] Supabase auth signIn error:",o);else if(n&&n.user){let a=n.user,r=a.user_metadata?.role||"patient",i={id:a.id,email:a.email||t,name:a.user_metadata?.name||a.email||t,role:r,phone:a.user_metadata?.phone||void 0,specialization:a.user_metadata?.specialization||void 0};if(s(i),localStorage.setItem("user",JSON.stringify(i)),"patient"===i.role){(i.email||"").toLowerCase().endsWith("@gmail.com"),d(!1),h(!0);try{let{patientService:t}=await e.A(24431);await t.getByEmail(i.email)||await t.create({name:i.name||i.email,email:i.email,phone:i.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after supabase login:",e)}}return}}catch(e){console.warn("[v0] Error authenticating via Supabase auth:",e)}throw Error("Invalid credentials")},g=async(e,t,a,r)=>{try{let i=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:a,phone:r})}),n=await i.json();if(!i.ok){if(409===i.status&&"exists"===n.status)return{status:"exists",user:n.user};throw Error(n.error||"Registration failed")}let o={id:n.user.id,email:n.user.email,name:n.user.name,role:"patient",phone:n.user.phone||r||void 0};return s(o),localStorage.setItem("user",JSON.stringify(o)),d(!1),{status:"created",user:o}}catch(e){throw console.error("[v0] Registration error:",e instanceof Error?e.message:String(e)),e}};return(0,t.jsx)(i.Provider,{value:{user:o,loading:l,login:p,register:g,logout:()=>{s(null),localStorage.removeItem("user"),(0,r.getSupabaseClient)().auth.signOut()},isAuthenticated:!!o,showPatientRegistration:!1,savePatientProfile:async()=>{}},children:n})}function o(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within AuthProvider");return e}e.s(["AuthProvider",()=>n,"useAuth",()=>o])},24431,e=>{e.v(t=>Promise.all(["static/chunks/0ccb5ad666565205.js"].map(t=>e.l(t))).then(()=>t(44496)))}]);