(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91432,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(3922);let i=(0,t.createContext)(void 0);function n({children:n}){let[o,s]=(0,t.useState)(null),[l,u]=(0,t.useState)(!0),[c,m]=(0,t.useState)(!1),[d,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{let a=(0,r.getSupabaseClient)(),{data:{user:t},error:i}=await a.auth.getUser();if(t&&!i){let a=t.email||"",r=t.user_metadata?.role||"patient",i=a.toLowerCase().endsWith("@gmail.com");if(s({id:t.id,email:a,name:t.user_metadata?.name||a||"",role:r,phone:t.user_metadata?.phone,specialization:t.user_metadata?.specialization}),"patient"===r&&i){m(!1),h(!0);try{let{patientService:r}=await e.A(24431);await r.getByEmail(a)||await r.create({name:t.user_metadata?.name||a,email:a,phone:t.user_metadata?.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record for Gmail user:",e)}}}}catch(e){console.error("[v0] Auth initialization error:",e)}u(!1)})()},[]);let p=async(a,t)=>{try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.from("auth_users").select("*").eq("email",a).maybeSingle();if(o&&console.warn("[v0] Supabase error checking auth_users:",o),n)if(n.password_hash===t){let a={id:n.id,email:n.email,name:n.name||n.email,role:n.role,phone:n.phone||void 0,specialization:n.specialization||void 0};s(a),localStorage.setItem("user",JSON.stringify(a));let t=(a.email||"").toLowerCase().endsWith("@gmail.com");if("patient"===a.role)if(t){m(!1),h(!0);try{let{patientService:t}=await e.A(24431);await t.getByEmail(a.email)||await t.create({name:a.name||a.email,email:a.email,phone:a.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after login:",e)}}else m(!0),h(!1);return}else throw Error("Invalid credentials")}catch(e){console.warn("[v0] Error authenticating against auth_users:",e)}try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.auth.signInWithPassword({email:a,password:t});if(o)console.warn("[v0] Supabase auth signIn error:",o);else if(n&&n.user){let t=n.user,r=t.user_metadata?.role||"patient",i={id:t.id,email:t.email||a,name:t.user_metadata?.name||t.email||a,role:r,phone:t.user_metadata?.phone||void 0,specialization:t.user_metadata?.specialization||void 0};if(s(i),localStorage.setItem("user",JSON.stringify(i)),"patient"===i.role){(i.email||"").toLowerCase().endsWith("@gmail.com"),m(!1),h(!0);try{let{patientService:a}=await e.A(24431);await a.getByEmail(i.email)||await a.create({name:i.name||i.email,email:i.email,phone:i.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after supabase login:",e)}}return}}catch(e){console.warn("[v0] Error authenticating via Supabase auth:",e)}throw Error("Invalid credentials")},g=async(e,a,t,r)=>{try{let i=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a,name:t,phone:r})}),n=await i.json();if(!i.ok){if(409===i.status&&"exists"===n.status)return{status:"exists",user:n.user};throw Error(n.error||"Registration failed")}let o={id:n.user.id,email:n.user.email,name:n.user.name,role:"patient",phone:n.user.phone||r||void 0};return s(o),localStorage.setItem("user",JSON.stringify(o)),m(!1),{status:"created",user:o}}catch(e){throw console.error("[v0] Registration error:",e instanceof Error?e.message:String(e)),e}};return(0,a.jsx)(i.Provider,{value:{user:o,loading:l,login:p,register:g,logout:()=>{s(null),localStorage.removeItem("user"),(0,r.getSupabaseClient)().auth.signOut()},isAuthenticated:!!o,showPatientRegistration:!1,savePatientProfile:async()=>{}},children:n})}function o(){let e=(0,t.useContext)(i);if(void 0===e)throw Error("useAuth must be used within AuthProvider");return e}e.s(["AuthProvider",()=>n,"useAuth",()=>o])},24431,e=>{e.v(a=>Promise.all(["static/chunks/43e260ef446aa5fa.js"].map(a=>e.l(a))).then(()=>a(44496)))}]);