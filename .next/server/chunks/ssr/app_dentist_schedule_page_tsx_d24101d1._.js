module.exports=[74943,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(21937),f=a.i(96313),g=a.i(3130),h=a.i(40695),i=a.i(30617),j=a.i(41675),k=a.i(34422),l=a.i(39761),m=a.i(16201),n=a.i(62722),o=a.i(41710),p=a.i(77156);let q=(0,a.i(70106).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var r=a.i(50522),s=a.i(90166),t=a.i(2288),u=a.i(33508);function v({appointment:a,onClose:d,onApprove:e,onReject:f}){let[g,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1);return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-card rounded-lg shadow-2xl max-w-md w-full",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-foreground",children:"Appointment Details"}),(0,b.jsx)("button",{onClick:d,className:"p-1 hover:bg-muted rounded-lg transition-colors",children:(0,b.jsx)(u.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Patient"}),(0,b.jsx)("p",{className:"text-foreground font-semibold",children:a.patientName||a.patients?.name||"N/A"}),a.patients?.email&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.patients.email})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Service"}),(0,b.jsx)("p",{className:"text-foreground",children:a.service})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Date"}),(0,b.jsx)("p",{className:"text-foreground",children:a.date})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Time"}),(0,b.jsx)("p",{className:"text-foreground",children:a.time})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,b.jsx)("p",{className:"text-foreground capitalize font-medium",children:a.status})]}),a.notes&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),(0,b.jsx)("p",{className:"text-foreground text-sm",children:a.notes})]})]}),j&&(0,b.jsxs)("div",{className:"space-y-2 pt-4 border-t border-border",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Rejection Reason"}),(0,b.jsx)("textarea",{value:g,onChange:a=>i(a.target.value),placeholder:"Why are you rejecting this appointment?",className:"w-full p-2 border border-border rounded-lg text-sm resize-none",rows:3})]}),(0,b.jsx)("div",{className:"flex gap-2 pt-4",children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{onClick:()=>k(!1),variant:"outline",className:"flex-1",children:"Back"}),(0,b.jsx)(h.Button,{onClick:()=>{g.trim()&&f(g)},disabled:!g.trim(),className:"flex-1 bg-destructive hover:bg-destructive/90 text-destructive-foreground",children:"Confirm Reject"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{onClick:d,variant:"outline",className:"flex-1 bg-transparent",children:"Close"}),(0,b.jsxs)(h.Button,{onClick:()=>k(!0),variant:"outline",className:"flex-1 text-destructive hover:bg-destructive/10",children:[(0,b.jsx)(n.XCircle,{className:"w-4 h-4 mr-2"}),"Reject"]}),(0,b.jsxs)(h.Button,{onClick:e,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[(0,b.jsx)(m.CheckCircle,{className:"w-4 h-4 mr-2"}),"Approve"]})]})})]})]})})}var w=a.i(21447);function x(){let a,{user:u}=(0,e.useAuth)(),x=(0,d.useRouter)(),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(new Date),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(0);(0,c.useEffect)(()=>{Q()},[u?.id,u?.email]);let Q=async()=>{try{if(!u?.id&&!u?.email)return;let a=await t.dentistService.getAll(),b=(a||[]).find(a=>a.user_id===u?.id),c=(a||[]).find(a=>(a.email||"").toLowerCase()===(u?.email||"").toLowerCase()),d=b||c;d?.id?(B(d.id),await R(d.id)):(console.warn("[v0] Dentist record not found for user; appointments will be empty"),B(null),z([]))}catch(a){console.error("[v0] Error resolving dentist record:",a),B(null),z([])}},R=async a=>{try{J(!0);let b=a||A;if(!b)return void z([]);let c=await t.appointmentService.getByDentistId(b);z(c||[])}catch(a){console.error("[v0] Error loading dentist appointments:",a instanceof Error?a.message:String(a)),z([])}finally{J(!1)}},S=[{label:"Dashboard",icon:(0,b.jsx)(i.LayoutDashboard,{className:"w-5 h-5"}),href:"/dentist/dashboard"},{label:"My Schedule",icon:(0,b.jsx)(j.Calendar,{className:"w-5 h-5"}),href:"/dentist/schedule"},{label:"Treatments",icon:(0,b.jsx)(k.Bluetooth,{className:"w-5 h-5"}),href:"/dentist/treatments"},{label:"Earnings",icon:(0,b.jsx)(s.DollarSign,{className:"w-5 h-5"}),href:"/dentist/earnings"},{label:"Reports",icon:(0,b.jsx)(l.BarChart3,{className:"w-5 h-5"}),href:"/dentist/reports"}],T=async a=>{try{await t.appointmentService.changeStatus(a,"confirmed"),z(y.map(b=>b.id===a?{...b,status:"confirmed"}:b)),console.log("[v0] âœ… Appointment approved successfully");try{await t.appointmentService.changeStatus(a,"completed"),z(b=>b.map(b=>b.id===a?{...b,status:"completed"}:b));let b=y.find(b=>b.id===a);if(b){let a=0;if(b.treatment_id)try{let c=await t.treatmentService.getById(b.treatment_id);a=c?.price||0}catch(a){console.warn("Could not resolve treatment by id for payment:",a)}if(!a)try{let c=(await t.treatmentService.getAll()||[]).find(a=>a.name===(b.service||b.treatment));a=c?.price||b.amount||0}catch(a){console.warn("Could not lookup treatments for amount resolution:",a)}let c={patient_id:b.patient_id,appointment_id:b.id,dentist_id:b.dentist_id||A||u?.id,amount:a||0,method:"cash",status:"paid",description:`Payment for ${b.service||"treatment"}`,date:new Date().toISOString().split("T")[0]};try{let a="string"==typeof c.dentist_id?c.dentist_id:null;a?c.dentist_id=a:console.error("[v0] Missing dentist_id when creating payment after approve"),await t.paymentService.create(c)}catch(a){console.error("Error creating payment record after approve:",a)}}}catch(a){console.error("Error completing + charging appointment after approve:",a)}F(!1);try{x.push("/dentist/schedule")}catch(a){console.warn("Navigation to schedule failed:",a)}}catch(a){console.error("Error approving appointment:",a)}},U=async(a,b)=>{try{await t.appointmentService.update(a,{status:"rejected",notes:b}),z(y.map(c=>c.id===a?{...c,status:"rejected",notes:b}:c)),F(!1);try{x.push("/dentist/schedule")}catch(a){console.warn("Navigation to schedule failed:",a)}}catch(a){console.error("Error rejecting appointment:",a)}},V=async a=>{try{await t.appointmentService.changeStatus(a,"completed"),z(y.map(b=>b.id===a?{...b,status:"completed"}:b));let b=y.find(b=>b.id===a);if(b){let a=b.amount||0;if(!a&&b.treatment_id)try{let c=await t.treatmentService.getById(b.treatment_id);a=c?.price||0}catch(a){console.warn("Could not resolve treatment by id:",a)}if(!a)try{let c=(await t.treatmentService.getAll()||[]).find(a=>a.name===(b.service||b.treatment));a=c?.price||0}catch(a){console.warn("Could not lookup treatments:",a)}a||(a=({Cleaning:500,"Tooth Cleaning":500,"Dental Cleaning":500,Filling:800,"Dental Filling":800,"Tooth Filling":800,"Root Canal":1500,"Root Canal Treatment":1500,Extraction:600,"Tooth Extraction":600,Whitening:2e3,"Teeth Whitening":2e3,Checkup:300,"Dental Checkup":300,Consultation:300,Braces:3e3,"Dental Braces":3e3,Crown:2500,"Dental Crown":2500})[b.service]||500),console.log("[v0] Calculated amount:",a,"for service:",b.service),N(b),P(a),L(!0)}}catch(a){console.error("Error completing appointment:",a),alert("Failed to complete appointment")}},W=async a=>{if(M)try{console.log("[v0] Collecting payment:",a);let b={patient_id:M.patient_id,dentist_id:M.dentist_id||A||u?.id,appointment_id:M.id,amount:a.amount,method:a.method,status:"paid",description:`${M.service||"treatment"} - ${a.notes||"Payment collected"}`,date:new Date().toISOString().split("T")[0]},c="string"==typeof b.dentist_id?b.dentist_id:null;if(!c){console.error("[v0] Missing dentist_id when collecting payment"),alert("Cannot record payment: dentist id is missing. Please re-open after reloading your dashboard.");return}b.dentist_id=c;let d=await t.paymentService.create(b);console.log("[v0] âœ… Payment saved to database:",d),L(!1),N(null),alert(`âœ… PAYMENT COLLECTED SUCCESSFULLY!

ðŸ’µ Amount: â‚±${a.amount.toLocaleString()}
ðŸ’³ Method: ${a.method.replace(/_/g," ").toUpperCase()}
ðŸ‘¨â€âš•ï¸ Your Share (50%): â‚±${(.5*a.amount).toLocaleString()}

ðŸ“Š Payment ID: ${d.id}

âœ“ Recorded in database
âœ“ Will appear in your Earnings
âœ“ Visible to HR in Payments section`),await R(),console.log("[v0] âœ… Appointments refreshed after payment")}catch(b){console.error("[v0] Error recording payment:",b);let a=b instanceof Error?b.message:String(b);alert(`âŒ Payment collection failed!

Error: ${a}

Please try again.`)}},X=a=>{H(a),F(!0)},Y=(a=C.toISOString().split("T")[0],y.filter(b=>b.date===a)),Z=y.filter(a=>"pending"===a.status),$=y.filter(a=>"confirmed"===a.status);return(0,b.jsxs)(f.default,{navItems:S,title:"My Schedule",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Your Dental Schedule"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Review pending appointments and manage your schedule"})]}),(0,b.jsx)(h.Button,{onClick:()=>R(),variant:"outline",size:"sm",children:"ðŸ”„ Refresh"})]}),Z.length>0&&(0,b.jsxs)(g.Card,{className:"border-yellow-300 bg-yellow-50/50",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-3",children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2 text-yellow-900",children:[(0,b.jsx)(o.Clock,{className:"w-5 h-5 text-yellow-600"}),"Action Required: ",Z.length," Pending Approval",1!==Z.length?"s":""]}),(0,b.jsx)(g.CardDescription,{className:"text-yellow-800",children:"HR has scheduled these appointments for you. Please review and approve or reject them."})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:Z.map(a=>(0,b.jsxs)("div",{className:"p-4 border-2 border-yellow-300 bg-white rounded-lg hover:bg-yellow-50/30 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-lg text-foreground",children:a.patients?.name||a.patientName}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.service||"General Visit"})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-bold text-primary",children:a.date}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.time})]})]}),a.notes&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-3 p-2 bg-muted/50 rounded",children:[(0,b.jsx)("span",{className:"font-medium",children:"Notes:"})," ",a.notes]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(h.Button,{onClick:()=>T(a.id),className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium",children:[(0,b.jsx)(m.CheckCircle,{className:"w-4 h-4 mr-2"}),"Approve"]}),(0,b.jsxs)(h.Button,{onClick:()=>X(a),variant:"outline",className:"flex-1 text-destructive hover:bg-destructive/10 font-medium",children:[(0,b.jsx)(n.XCircle,{className:"w-4 h-4 mr-2"}),"Reject"]})]})]},a.id))})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.CardTitle,{children:"Daily Schedule"}),(0,b.jsx)(g.CardDescription,{children:C.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>{D(new Date(C.getTime()-864e5))},className:"p-2 hover:bg-muted rounded-lg transition-colors",children:(0,b.jsx)(q,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:()=>D(new Date),className:"px-4 py-2 hover:bg-muted rounded-lg transition-colors text-sm font-medium",children:"Today"}),(0,b.jsx)("button",{onClick:()=>{D(new Date(C.getTime()+864e5))},className:"p-2 hover:bg-muted rounded-lg transition-colors",children:(0,b.jsx)(r.ChevronRight,{className:"w-5 h-5"})})]})]}),(0,b.jsx)(g.CardContent,{children:0===Y.length?(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No appointments scheduled for this date"})}):(0,b.jsx)("div",{className:"space-y-3",children:Y.map(a=>(0,b.jsxs)("div",{className:"p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-foreground",children:a.patients?.name||a.patientName}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.service})]}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${"confirmed"===a.status?"bg-green-100 text-green-700":"pending"===a.status?"bg-yellow-100 text-yellow-700":"completed"===a.status?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(o.Clock,{className:"w-4 h-4"}),a.time]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(h.Button,{size:"sm",variant:"outline",className:"text-xs bg-transparent",onClick:()=>X(a),children:[(0,b.jsx)(p.Eye,{className:"w-3 h-3 mr-1"}),"Details"]}),"pending"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(h.Button,{size:"sm",onClick:()=>T(a.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs",children:[(0,b.jsx)(m.CheckCircle,{className:"w-3 h-3 mr-1"}),"Approve"]}),(0,b.jsxs)(h.Button,{size:"sm",onClick:()=>X(a),variant:"outline",className:"text-xs text-destructive hover:bg-destructive/10",children:[(0,b.jsx)(n.XCircle,{className:"w-3 h-3 mr-1"}),"Reject"]})]}),"confirmed"===a.status&&(0,b.jsxs)(h.Button,{size:"sm",onClick:()=>V(a.id),className:"bg-blue-600 hover:bg-blue-700 text-white text-xs",children:[(0,b.jsx)(m.CheckCircle,{className:"w-3 h-3 mr-1"}),"Complete"]})]})]})]},a.id))})})]}),Z.length>0&&(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Clock,{className:"w-5 h-5 text-yellow-600"}),"Pending Approvals (",Z.length,")"]}),(0,b.jsx)(g.CardDescription,{children:"Appointments awaiting your decision"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:Z.map(a=>(0,b.jsxs)("div",{className:"p-4 border border-yellow-200 bg-yellow-50/50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-foreground",children:a.patientName}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.service})]}),(0,b.jsxs)("div",{className:"text-sm font-medium text-muted-foreground",children:[a.date," at ",a.time]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(h.Button,{onClick:()=>T(a.id),className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[(0,b.jsx)(m.CheckCircle,{className:"w-4 h-4 mr-2"}),"Approve"]}),(0,b.jsxs)(h.Button,{onClick:()=>X(a),variant:"outline",className:"flex-1 text-destructive hover:bg-destructive/10",children:[(0,b.jsx)(n.XCircle,{className:"w-4 h-4 mr-2"}),"Reject"]})]})]},a.id))})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(g.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(g.CardHeader,{className:"pb-3",children:(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approvals"})}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:Z.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting your action"})]})]}),(0,b.jsxs)(g.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(g.CardHeader,{className:"pb-3",children:(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Confirmed Today"})}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-green-600",children:Y.filter(a=>"confirmed"===a.status).length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Scheduled for today"})]})]}),(0,b.jsxs)(g.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(g.CardHeader,{className:"pb-3",children:(0,b.jsx)(g.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"This Week"})}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-primary",children:y.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total appointments"})]})]})]}),$.length>0&&(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m.CheckCircle,{className:"w-5 h-5 text-green-600"}),"Confirmed Appointments (",$.length,")"]})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:$.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"p-3 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:a.patientName}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.date," at ",a.time," - ",a.service]})]}),(0,b.jsx)(h.Button,{size:"sm",onClick:()=>V(a.id),className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Complete"})]},a.id))})})]})]}),E&&G&&(0,b.jsx)(v,{appointment:G,onClose:()=>F(!1),onApprove:()=>{T(G.id),F(!1)},onReject:a=>{U(G.id,a),F(!1)}}),M&&(0,b.jsx)(w.default,{open:K,onClose:()=>{L(!1),N(null)},onCollect:W,appointmentData:{patientName:M.patientName||"Unknown Patient",service:M.service||"Treatment",suggestedAmount:O}})]})}a.s(["default",()=>x],74943)}];

//# sourceMappingURL=app_dentist_schedule_page_tsx_d24101d1._.js.map