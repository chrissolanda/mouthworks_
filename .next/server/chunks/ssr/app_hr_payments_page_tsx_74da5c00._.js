module.exports=[56237,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(21937),e=a.i(96313),f=a.i(3130),g=a.i(40695),h=a.i(5522),i=a.i(30617),j=a.i(60246),k=a.i(41675),l=a.i(34422),m=a.i(11156),n=a.i(83497),o=a.i(39761),p=a.i(21161),q=a.i(81560),r=a.i(87532),s=a.i(16201),t=a.i(92e3),u=a.i(84505),v=a.i(2288),w=a.i(97895),x=a.i(40018),y=a.i(33508);function z({onClose:a,onSubmit:d}){let[e,f]=(0,c.useState)({patient_id:"",dentist_id:"",amount:"",method:"Cash",status:"paid",description:""}),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0);(0,c.useEffect)(()=>{o()},[]);let o=async()=>{try{n(!0);let[a,b]=await Promise.all([v.patientService.getAll(),v.dentistService.getAll()]);j(a||[]),l(b||[])}catch(a){console.error("Error loading data:",a)}finally{n(!1)}},p=a=>{let{name:b,value:c}=a.target;f(a=>({...a,[b]:c}))};return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-card rounded-lg shadow-2xl max-w-md w-full max-h-96 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-foreground",children:"Record Payment"}),(0,b.jsx)("button",{onClick:a,className:"p-1 hover:bg-muted rounded-lg transition-colors",children:(0,b.jsx)(y.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),e.patient_id&&e.amount&&e.description&&e.dentist_id&&(d({patient_id:e.patient_id,dentist_id:e.dentist_id,amount:Number.parseFloat(e.amount),method:e.method,status:e.status,description:e.description,date:new Date().toISOString().split("T")[0]}),f({patient_id:"",dentist_id:"",amount:"",method:"Cash",status:"paid",description:""}))},className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Patient *"}),m?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."}):(0,b.jsxs)("select",{name:"patient_id",value:e.patient_id,onChange:p,className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Select patient..."}),i.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Dentist *"}),m?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading..."}):(0,b.jsxs)("select",{name:"dentist_id",value:e.dentist_id,onChange:p,className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Select dentist..."}),k.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Amount (â‚±) *"}),(0,b.jsx)(h.Input,{name:"amount",type:"number",step:"0.01",value:e.amount,onChange:p,placeholder:"0.00",className:"border-border",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Payment Method"}),(0,b.jsxs)("select",{name:"method",value:e.method,onChange:p,className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground",children:[(0,b.jsx)("option",{children:"Cash"}),(0,b.jsx)("option",{children:"Bank Transfer"}),(0,b.jsx)("option",{children:"Credit Card"}),(0,b.jsx)("option",{children:"Check"}),(0,b.jsx)("option",{children:"Insurance"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Status"}),(0,b.jsxs)("select",{name:"status",value:e.status,onChange:p,className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground",children:[(0,b.jsx)("option",{value:"paid",children:"Paid"}),(0,b.jsx)("option",{value:"partial",children:"Partial"}),(0,b.jsx)("option",{value:"unpaid",children:"Unpaid"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Description *"}),(0,b.jsx)("textarea",{name:"description",value:e.description,onChange:p,placeholder:"e.g., Cleaning - Dec 5, 2024",className:"w-full p-2 border border-border rounded-lg text-sm resize-none bg-background text-foreground",rows:2,required:!0})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsx)(g.Button,{type:"button",onClick:a,variant:"outline",className:"flex-1 bg-transparent",children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground",disabled:m,children:"Record Payment"})]})]})]})})}var A=a.i(56459);function B(){let{user:a}=(0,d.useAuth)(),[y,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)("all"),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)("");(0,c.useEffect)(()=>{Y();let a=setInterval(()=>{Y()},3e3),b=()=>{Y()};return window.addEventListener("paymentRecorded",b),window.addEventListener("paymentDeleted",b),window.addEventListener("appointmentUpdated",b),window.addEventListener("dataChanged",b),()=>{clearInterval(a),window.removeEventListener("paymentRecorded",b),window.removeEventListener("paymentDeleted",b),window.removeEventListener("appointmentUpdated",b),window.removeEventListener("dataChanged",b)}},[]);let Y=async()=>{try{console.log("[v0] ðŸ”„ Loading payments, patients, and appointments from database..."),H(!0);let[a,b,c]=await Promise.all([v.paymentService.getAll(),v.patientService.getAll(),v.appointmentService.getAll()]);console.log("[v0] âœ… Loaded",a?.length||0,"payments"),console.log("[v0] âœ… Loaded",b?.length||0,"patients"),console.log("[v0] âœ… Loaded",c?.length||0,"appointments");let d=(c||[]).filter(b=>"completed"===b.status&&!(a||[]).some(a=>a.appointment_id===b.id));B(a||[]),D(b||[]),F(d)}catch(a){console.error("[v0] âŒ Error loading data:",a),console.error("[v0] Error details:",a instanceof Error?a.message:a),B([]),D([]),F([])}finally{H(!1)}},Z=[{label:"Dashboard",icon:(0,b.jsx)(i.LayoutDashboard,{className:"w-5 h-5"}),href:"/hr/dashboard"},{label:"Patients",icon:(0,b.jsx)(j.Users,{className:"w-5 h-5"}),href:"/hr/patients"},{label:"Appointments",icon:(0,b.jsx)(k.Calendar,{className:"w-5 h-5"}),href:"/hr/appointments"},{label:"Treatments",icon:(0,b.jsx)(l.Bluetooth,{className:"w-5 h-5"}),href:"/hr/treatments"},{label:"Payments",icon:(0,b.jsx)(m.CreditCard,{className:"w-5 h-5"}),href:"/hr/payments"},{label:"Inventory",icon:(0,b.jsx)(n.Package,{className:"w-5 h-5"}),href:"/hr/inventory"},{label:"Reports",icon:(0,b.jsx)(o.BarChart3,{className:"w-5 h-5"}),href:"/hr/reports"},{label:"Settings",icon:(0,b.jsx)(p.Settings,{className:"w-5 h-5"}),href:"/hr/settings"}],$=async a=>{try{console.log("[v0] ðŸ’¾ Recording payment to database:",a);let b=await v.paymentService.create(a);if(!b||!b.id)throw Error("Payment was not saved to database");if(console.log("[v0] âœ… Payment saved to database with ID:",b.id),a.appointment_id)try{await v.appointmentService.update(a.appointment_id,{status:"paid"}),console.log("[v0] âœ… Appointment status updated to paid")}catch(a){console.warn("[v0] Warning: Could not update appointment status:",a)}console.log("[v0] ðŸ”„ Reloading all payments from database..."),await Y(),console.log("[v0] âœ… Data reloaded successfully"),J(!1),L(!1),N(null),alert(`âœ… Payment recorded successfully!

Amount: â‚±${a.amount}
Status: ${a.status}

Payment is now visible in the system.`)}catch(a){console.error("[v0] âŒ Error recording payment:",a),alert("âŒ Error recording payment: "+(a instanceof Error?a.message:"Unknown error")+"\n\nPlease try again.")}},_=async a=>{if(!M)return"";try{let b=await v.paymentService.create({patient_id:M.patient_id,dentist_id:M.dentist_id||"",appointment_id:M.id,amount:a.amount,method:a.method,status:"paid",description:a.notes,date:new Date().toISOString().split("T")[0]});return await v.appointmentService.update(M.id,{status:"paid"}),await Y(),b.id}catch(a){throw console.error("[v0] Error recording payment:",a),Error("Failed to record payment: "+(a instanceof Error?a.message:"Unknown error"))}},aa=async a=>{if(confirm("Are you sure you want to delete this payment record?"))try{await v.paymentService.delete(a),B(y.filter(b=>b.id!==a))}catch(a){console.error("[v0] Error deleting payment:",a),alert("Error deleting payment: "+(a instanceof Error?a.message:"Unknown error"))}},ab=async(a,b,c)=>{try{let d=await v.paymentService.update(a,{[b]:c});B(y.map(b=>b.id===a?d:b)),T(null),V(null),X("")}catch(a){console.error("[v0] Error updating payment:",a),alert("Error updating payment: "+(a instanceof Error?a.message:"Unknown error"))}},ac=y.filter(a=>{let b="all"===O||a.status===O,c=C.find(b=>b.id===a.patient_id),d=c?.name.toLowerCase().includes(Q.toLowerCase())||a.description?.toLowerCase().includes(Q.toLowerCase());return b&&d}),ad=y.filter(a=>"paid"===a.status).reduce((a,b)=>a+b.amount,0),ae=y.filter(a=>"partial"===a.status).reduce((a,b)=>a+b.amount,0),af=y.filter(a=>"unpaid"===a.status).reduce((a,b)=>a+b.amount,0),ag={paid:y.filter(a=>"paid"===a.status).length,partial:y.filter(a=>"partial"===a.status).length,unpaid:y.filter(a=>"unpaid"===a.status).length};return(0,b.jsxs)(e.default,{navItems:Z,title:"Payment Management",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Payment Tracking"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Record and manage patient payments"})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(g.Button,{onClick:Y,variant:"outline",size:"sm",children:"ðŸ”„ Refresh"})})]}),E.length>0&&(0,b.jsxs)(f.Card,{className:"border-green-300 bg-green-50/50 shadow-lg",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2 text-green-900",children:[(0,b.jsx)(s.CheckCircle,{className:"w-5 h-5 text-green-600"}),"Completed Appointments - Ready for Payment (",E.length,")"]}),(0,b.jsx)(f.CardDescription,{className:"text-green-700",children:"Click on any appointment to record payment"})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:E.map(a=>(0,b.jsxs)("button",{onClick:()=>{N(a),L(!0)},className:"p-5 border-2 border-green-300 bg-white rounded-lg hover:bg-green-50 hover:border-green-500 transition-all text-left group",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-bold text-lg text-foreground group-hover:text-primary",children:a.patients?.name||"Unknown Patient"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[(0,b.jsx)("span",{className:"font-medium",children:a.service||"General Visit"}),a.dentists?.name&&` â€¢ Dr. ${a.dentists.name}`]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-bold text-primary",children:a.date}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.time})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-green-200",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ COMPLETED"}),a.amount&&(0,b.jsxs)("span",{className:"text-sm font-bold text-primary",children:["Amount: ",(0,w.formatCurrency)(a.amount)]}),(0,b.jsx)("span",{className:"text-sm font-bold text-primary group-hover:underline",children:"Record Payment â†’"})]})]},a.id))})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(f.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Paid"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-green-600",children:(0,w.formatCurrency)(ad)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[ag.paid," payments"]})]})]}),(0,b.jsxs)(f.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Partial Payments"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:(0,w.formatCurrency)(ae)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[ag.partial," payments"]})]})]}),(0,b.jsxs)(f.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Unpaid Balance"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-destructive",children:(0,w.formatCurrency)(af)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[ag.unpaid," unpaid"]})]})]}),(0,b.jsxs)(f.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-primary",children:(0,w.formatCurrency)(ad+ae)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Received so far"})]})]})]}),(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardContent,{className:"pt-6 space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(r.Search,{className:"absolute left-3 top-2.5 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(h.Input,{type:"text",placeholder:"Search by patient name or description...",value:Q,onChange:a=>R(a.target.value),className:"pl-10 border-border"})]}),(0,b.jsx)("div",{className:"flex gap-2",children:["all","paid","partial","unpaid"].map(a=>(0,b.jsx)("button",{onClick:()=>P(a),className:`px-4 py-2 rounded-lg font-medium transition-colors text-sm ${O===a?"bg-primary text-primary-foreground":"bg-muted text-foreground hover:bg-muted/80"}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})]})}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Payment Records"}),(0,b.jsxs)(f.CardDescription,{children:[ac.length," payment(s) found"]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Date"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Patient"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Dentist"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Description"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Method"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-foreground",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:0===ac.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"py-8 text-center text-muted-foreground",children:"No payments found"})}):ac.map(a=>{let c=C.find(b=>b.id===a.patient_id);return(0,b.jsxs)("tr",{className:"border-b border-border hover:bg-muted/50 transition-colors",children:[(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:a.date?new Date(a.date).toLocaleDateString():"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm font-medium text-foreground",children:c?.name||"Unknown"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:a.dentists?.name||"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:a.description||"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm font-semibold text-foreground",children:(0,w.formatCurrency)(a.amount)}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:a.method||"-"}),(0,b.jsx)("td",{className:"py-3 px-4",children:S===a.id&&"status"===U?(0,b.jsxs)("select",{value:W,onChange:a=>X(a.target.value),onBlur:()=>ab(a.id,"status",W),className:"px-2 py-1 border border-border rounded text-xs bg-background text-foreground",autoFocus:!0,children:[(0,b.jsx)("option",{value:"paid",children:"Paid"}),(0,b.jsx)("option",{value:"partial",children:"Partial"}),(0,b.jsx)("option",{value:"unpaid",children:"Unpaid"})]}):(0,b.jsxs)("button",{onClick:()=>{T(a.id),V("status"),X(a.status)},className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold cursor-pointer hover:opacity-80 transition-opacity ${"paid"===a.status?"bg-green-100 text-green-700":"partial"===a.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["paid"===a.status?(0,b.jsx)(s.CheckCircle,{className:"w-3 h-3"}):(0,b.jsx)(t.AlertCircle,{className:"w-3 h-3"}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})}),(0,b.jsx)("td",{className:"py-3 px-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>{let b,c;return b=C.find(b=>b.id===a.patient_id),c={receiptNumber:a.id.slice(0,8).toUpperCase(),date:a.date?new Date(a.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),patientName:b?.name||a.patients?.name||"Unknown Patient",patientEmail:b?.email||a.patients?.email,dentistName:a.dentists?.name||"Not Assigned",service:a.description||"Dental Service",amount:a.amount,method:a.method||"Cash",notes:a.description},void(0,x.downloadReceipt)(c)},className:"p-1.5 hover:bg-primary/10 rounded-lg transition-colors text-primary",title:"Download receipt",children:(0,b.jsx)(u.Download,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>aa(a.id),className:"p-1.5 hover:bg-destructive/10 rounded-lg transition-colors text-destructive",title:"Delete payment",children:(0,b.jsx)(q.Trash2,{className:"w-4 h-4"})})]})})]},a.id)})})]})})})]})]}),G?(0,b.jsx)(f.Card,{children:(0,b.jsx)(f.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Loading payments..."})})}):(0,b.jsxs)(b.Fragment,{children:[I&&(0,b.jsx)(z,{onClose:()=>J(!1),onSubmit:$}),K&&M&&(0,b.jsx)(A.default,{appointment:M,onClose:()=>{L(!1),N(null)},onRecordPayment:_})]})]})}a.s(["default",()=>B],56237)}];

//# sourceMappingURL=app_hr_payments_page_tsx_74da5c00._.js.map