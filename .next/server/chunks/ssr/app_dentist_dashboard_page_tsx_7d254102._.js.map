{"version":3,"sources":["../../../../app/dentist/dashboard/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useAuth } from \"@/lib/auth-context\"\r\nimport MainLayout from \"@/components/layout/main-layout\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { LayoutDashboard, Calendar, Bluetooth as Tooth, BarChart3, CheckCircle, XCircle, DollarSign } from \"lucide-react\"\r\nimport { useState, useEffect } from \"react\"\r\nimport { appointmentService, dentistService, paymentService, treatmentService } from \"@/lib/db-service\"\r\nimport CollectPaymentModal from \"@/components/modals/collect-payment-modal\"\r\n\r\ninterface Appointment {\r\n  id: string\r\n  patient_id: string\r\n  dentist_id: string\r\n  date: string\r\n  time: string\r\n  status: string\r\n  treatment_id?: string\r\n  service?: string\r\n  treatment?: string\r\n  amount?: number\r\n  notes?: string\r\n  patients?: {\r\n    name: string\r\n    email: string\r\n  }\r\n  dentists?: {\r\n    name: string\r\n  }\r\n}\r\n\r\nexport default function DentistDashboard() {\r\n  const { user } = useAuth()\r\n  const [appointments, setAppointments] = useState<Appointment[]>([])\r\n  const [dentistTableId, setDentistTableId] = useState<string | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [processingId, setProcessingId] = useState<string | null>(null)\r\n  const [showCollectModal, setShowCollectModal] = useState(false)\r\n  const [selectedAppointment, setSelectedAppointment] = useState<Appointment | null>(null)\r\n  const [calculatedAmount, setCalculatedAmount] = useState(0)\r\n  const [stats, setStats] = useState({\r\n    totalAppointments: 0,\r\n    completed: 0,\r\n    pending: 0,\r\n    earnings: 0,\r\n  })\r\n\r\n  useEffect(() => {\r\n    loadData()\r\n    // Auto-refresh every 3 seconds to show new payments\r\n    const interval = setInterval(() => {\r\n      loadData()\r\n    }, 3000)\r\n    return () => clearInterval(interval)\r\n  }, [user?.email])\r\n\r\n  const loadData = async () => {\r\n    if (!user?.email) return\r\n    try {\r\n      // Map auth user -> dentist table row (prefer user_id, fallback email)\r\n      const dentists = await dentistService.getAll()\r\n      const matchByUser = (dentists || []).find((d: any) => d.user_id === user.id)\r\n      const matchByEmail = (dentists || []).find(\r\n        (d: any) => (d.email || \"\").toLowerCase() === (user.email || \"\").toLowerCase(),\r\n      )\r\n      const match = matchByUser || matchByEmail\r\n      if (match?.id) {\r\n        setDentistTableId(match.id)\r\n        await loadAppointments(match.id)\r\n      } else {\r\n        setDentistTableId(null)\r\n        setAppointments([])\r\n      }\r\n    } catch (err) {\r\n      console.error(\"[v0] Error loading dentist record:\", err)\r\n      setAppointments([])\r\n    }\r\n  }\r\n\r\n  const loadAppointments = async (dentistId?: string) => {\r\n    const idToUse = dentistId || dentistTableId\r\n    if (!idToUse) return\r\n    try {\r\n      setLoading(true)\r\n      const data = await appointmentService.getByDentistId(idToUse)\r\n      setAppointments(data || [])\r\n      \r\n      // Calculate stats\r\n      const completed = (data || []).filter((a: any) => a.status === \"completed\").length\r\n      const pending = (data || []).filter((a: any) => a.status === \"pending\").length\r\n      \r\n      // Load earnings from payments\r\n      try {\r\n        const payments = await paymentService.getByDentistId(idToUse)\r\n        const totalEarnings = (payments || [])\r\n          .filter((p: any) => p.status === \"paid\" || p.status === \"partial\")\r\n          .reduce((sum: number, p: any) => sum + (p.amount || 0), 0)\r\n        \r\n        setStats({\r\n          totalAppointments: (data || []).length,\r\n          completed,\r\n          pending,\r\n          earnings: totalEarnings,\r\n        })\r\n      } catch (err) {\r\n        console.log(\"[v0] Could not load earnings from payments (this is OK):\", err)\r\n        setStats({\r\n          totalAppointments: (data || []).length,\r\n          completed,\r\n          pending,\r\n          earnings: 0,\r\n        })\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error loading appointments:\", error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleApproveAppointment = async (appointmentId: string) => {\r\n    setProcessingId(appointmentId)\r\n    try {\r\n      await appointmentService.changeStatus(appointmentId, \"confirmed\")\r\n      setAppointments((prev) => prev.map((apt) => (apt.id === appointmentId ? { ...apt, status: \"confirmed\" } : apt)))\r\n    } catch (error) {\r\n      console.error(\"[v0] Error approving appointment:\", error)\r\n      alert(\"Failed to approve appointment\")\r\n    } finally {\r\n      setProcessingId(null)\r\n    }\r\n  }\r\n\r\n  const handleCompleteAppointment = async (appointment: Appointment) => {\r\n    setProcessingId(appointment.id)\r\n    try {\r\n      // Mark appointment as completed first\r\n      await appointmentService.changeStatus(appointment.id, \"completed\")\r\n      setAppointments((prev) => prev.map((apt) => (apt.id === appointment.id ? { ...apt, status: \"completed\" } : apt)))\r\n      \r\n      // Calculate price\r\n      let amount = appointment.amount || 0\r\n      \r\n      // Try to get price from treatment_id\r\n      if (!amount && appointment.treatment_id) {\r\n        try {\r\n          const treatment = await treatmentService.getById(appointment.treatment_id)\r\n          amount = treatment?.price || 0\r\n        } catch (e) {\r\n          console.warn(\"[v0] Could not resolve treatment by id:\", e)\r\n        }\r\n      }\r\n      \r\n      // Try to match by service name\r\n      if (!amount) {\r\n        try {\r\n          const treatments = await treatmentService.getAll()\r\n          const matched = (treatments || []).find((t: any) => t.name === (appointment.service || appointment.treatment))\r\n          amount = matched?.price || 0\r\n        } catch (e) {\r\n          console.warn(\"[v0] Could not lookup treatments:\", e)\r\n        }\r\n      }\r\n      \r\n      // Use default prices based on service name\r\n      if (!amount) {\r\n        const defaultPrices: Record<string, number> = {\r\n          \"Cleaning\": 500, \"Tooth Cleaning\": 500, \"Dental Cleaning\": 500,\r\n          \"Filling\": 800, \"Dental Filling\": 800, \"Tooth Filling\": 800,\r\n          \"Root Canal\": 1500, \"Root Canal Treatment\": 1500,\r\n          \"Extraction\": 600, \"Tooth Extraction\": 600,\r\n          \"Whitening\": 2000, \"Teeth Whitening\": 2000,\r\n          \"Checkup\": 300, \"Dental Checkup\": 300, \"Consultation\": 300,\r\n          \"Braces\": 3000, \"Dental Braces\": 3000,\r\n          \"Crown\": 2500, \"Dental Crown\": 2500,\r\n        }\r\n        amount = defaultPrices[appointment.service] || 500\r\n      }\r\n      \r\n      console.log(\"[v0] Calculated amount:\", amount, \"for service:\", appointment.service)\r\n      \r\n      // Show collect payment modal\r\n      setSelectedAppointment(appointment)\r\n      setCalculatedAmount(amount)\r\n      setShowCollectModal(true)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error completing appointment:\", error)\r\n      alert(\"Failed to complete appointment\")\r\n    } finally {\r\n      setProcessingId(null)\r\n    }\r\n  }\r\n\r\n  const handleCollectPayment = async (paymentData: { method: string; amount: number; notes?: string }) => {\r\n    if (!selectedAppointment) return\r\n\r\n    try {\r\n      console.log(\"[v0] Collecting payment:\", paymentData)\r\n      \r\n      const paymentPayload = {\r\n        patient_id: selectedAppointment.patient_id,\r\n        dentist_id: typeof selectedAppointment.dentist_id === \"string\" ? selectedAppointment.dentist_id : dentistTableId,\r\n        appointment_id: selectedAppointment.id,\r\n        amount: paymentData.amount,\r\n        method: paymentData.method,\r\n        status: \"paid\",\r\n        description: `${selectedAppointment.service || \"treatment\"} - ${paymentData.notes || \"Payment collected\"}`,\r\n        date: new Date().toISOString().split(\"T\")[0],\r\n      }\r\n      \r\n      const dentistId = typeof paymentPayload.dentist_id === \"string\" ? paymentPayload.dentist_id : null\r\n      if (!dentistId) {\r\n        console.error(\"[v0] Missing dentist_id when collecting payment from dashboard\")\r\n        alert(\"Cannot record payment: dentist id is missing. Please reopen after reloading your dashboard.\")\r\n        return\r\n      }\r\n\r\n      paymentPayload.dentist_id = dentistId\r\n\r\n      const createdPayment = await paymentService.create(paymentPayload)\r\n      console.log(\"[v0] âœ… Payment saved to database:\", createdPayment)\r\n      \r\n      // Close modal and show success\r\n      setShowCollectModal(false)\r\n      setSelectedAppointment(null)\r\n      \r\n      alert(\r\n        `âœ… PAYMENT COLLECTED SUCCESSFULLY!\\n\\n` +\r\n        `ðŸ’µ Amount: â‚±${paymentData.amount.toLocaleString()}\\n` +\r\n        `ðŸ’³ Method: ${paymentData.method.replace(/_/g, \" \").toUpperCase()}\\n` +\r\n        `ðŸ‘¨â€âš•ï¸ Your Share (50%): â‚±${(paymentData.amount * 0.5).toLocaleString()}\\n\\n` +\r\n        `ðŸ“Š Payment ID: ${createdPayment.id}\\n\\n` +\r\n        `âœ“ Recorded in database\\n` +\r\n        `âœ“ Will appear in your Earnings\\n` +\r\n        `âœ“ Visible to HR in Payments section`\r\n      )\r\n      \r\n      // Reload appointments to update stats\r\n      loadAppointments()\r\n    } catch (error) {\r\n      console.error(\"[v0] Error recording payment:\", error)\r\n      const errorMsg = error instanceof Error ? error.message : String(error)\r\n      alert(`âŒ Payment collection failed!\\n\\nError: ${errorMsg}\\n\\nPlease try again or contact support.`)\r\n    }\r\n  }\r\n\r\n  const handleRejectAppointment = async (appointmentId: string) => {\r\n    setProcessingId(appointmentId)\r\n    try {\r\n      await appointmentService.changeStatus(appointmentId, \"rejected\")\r\n      setAppointments((prev) => prev.map((apt) => (apt.id === appointmentId ? { ...apt, status: \"rejected\" } : apt)))\r\n    } catch (error) {\r\n      console.error(\"[v0] Error rejecting appointment:\", error)\r\n      alert(\"Failed to reject appointment\")\r\n    } finally {\r\n      setProcessingId(null)\r\n    }\r\n  }\r\n\r\n\r\n\r\n  const pendingAppointments = appointments.filter((apt) => apt.status === \"pending\")\r\n  const approvedAppointments = appointments.filter((apt) => apt.status === \"confirmed\" || apt.status === \"attended\")\r\n  const todayAppointments = approvedAppointments.filter((apt) => {\r\n    const today = new Date().toISOString().split(\"T\")[0]\r\n    return apt.date === today\r\n  })\r\n\r\n  const navItems = [\r\n    { label: \"Dashboard\", icon: <LayoutDashboard className=\"w-5 h-5\" />, href: \"/dentist/dashboard\" },\r\n    { label: \"My Schedule\", icon: <Calendar className=\"w-5 h-5\" />, href: \"/dentist/schedule\" },\r\n    { label: \"Treatments\", icon: <Tooth className=\"w-5 h-5\" />, href: \"/dentist/treatments\" },\r\n    { label: \"Earnings\", icon: <DollarSign className=\"w-5 h-5\" />, href: \"/dentist/earnings\" },\r\n    { label: \"Reports\", icon: <BarChart3 className=\"w-5 h-5\" />, href: \"/dentist/reports\" },\r\n  ]\r\n\r\n  return (\r\n    <MainLayout navItems={navItems} title=\"Dentist Schedule\">\r\n      <div className=\"space-y-6\">\r\n        {/* Welcome Section */}\r\n        <div className=\"bg-gradient-to-r from-primary to-accent rounded-lg p-6 text-primary-foreground\">\r\n          <h1 className=\"text-3xl font-bold mb-2\">Welcome, {user?.name}</h1>\r\n          <p className=\"opacity-90\">Manage your appointments and patient treatments</p>\r\n        </div>\r\n\r\n        {/* Quick Stats */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          <Card className=\"hover:shadow-md transition-shadow\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Today's Appointments</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-primary\">{todayAppointments.length}</div>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">All confirmed</p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"hover:shadow-md transition-shadow\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Pending Approvals</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-yellow-600\">{pendingAppointments.length}</div>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">Awaiting action</p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"hover:shadow-md transition-shadow\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">This Week</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-primary\">{approvedAppointments.length}</div>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">Total appointments</p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"hover:shadow-md transition-shadow\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">ðŸ’µ Total Earnings</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold text-green-600\">â‚±{(stats.earnings || 0).toLocaleString()}</div>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">From completed appointments</p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Pending Approvals */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Pending Appointment Approvals</CardTitle>\r\n            <CardDescription>Appointments awaiting your decision</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {loading ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">Loading appointments...</div>\r\n            ) : pendingAppointments.length === 0 ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">No pending appointments</div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {pendingAppointments.map((apt) => (\r\n                  <div\r\n                    key={apt.id}\r\n                    className=\"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                        <span className=\"text-sm font-semibold text-primary\">\r\n                          {apt.patients?.name ? apt.patients.name.charAt(0) : \"?\"}\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium text-foreground\">{apt.patients?.name || \"Unknown Patient\"}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {apt.date} at {apt.time}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                        onClick={() => handleApproveAppointment(apt.id)}\r\n                        disabled={processingId === apt.id}\r\n                      >\r\n                        <CheckCircle className=\"w-4 h-4 mr-1\" />\r\n                        {processingId === apt.id ? \"...\" : \"Accept\"}\r\n                      </Button>\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        className=\"border-destructive text-destructive hover:bg-destructive/10 bg-transparent\"\r\n                        onClick={() => handleRejectAppointment(apt.id)}\r\n                        disabled={processingId === apt.id}\r\n                      >\r\n                        <XCircle className=\"w-4 h-4 mr-1\" />\r\n                        {processingId === apt.id ? \"...\" : \"Reject\"}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Approved / Attended */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Approved / Attended</CardTitle>\r\n            <CardDescription>Complete after visit</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {approvedAppointments.length === 0 ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">No approved/attended appointments</div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {approvedAppointments.map((apt) => (\r\n                  <div\r\n                    key={apt.id}\r\n                    className=\"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                        <span className=\"text-sm font-semibold text-primary\">\r\n                          {apt.patients?.name ? apt.patients.name.charAt(0) : \"?\"}\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium text-foreground\">{apt.patients?.name || \"Unknown Patient\"}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {apt.date} at {apt.time}\r\n                        </p>\r\n                        {apt.status === \"attended\" && (\r\n                          <p className=\"text-xs text-blue-600\">Patient marked as attended</p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                        onClick={() => handleCompleteAppointment(apt)}\r\n                        disabled={processingId === apt.id}\r\n                      >\r\n                        <CheckCircle className=\"w-4 h-4 mr-1\" />\r\n                        {processingId === apt.id ? \"...\" : \"Complete\"}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Today's Schedule */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Today's Schedule</CardTitle>\r\n            <CardDescription>Your confirmed appointments for today</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {todayAppointments.length === 0 ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">No appointments today</div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {todayAppointments.map((apt) => (\r\n                  <div key={apt.id} className=\"flex items-center justify-between p-3 border border-border rounded-lg\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"font-medium text-foreground\">{apt.patients?.name || \"Unknown Patient\"}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">{apt.time}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full\">Confirmed</span>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n      </div>\r\n\r\n      {/* Collect Payment Modal */}\r\n      {selectedAppointment && (\r\n        <CollectPaymentModal\r\n          open={showCollectModal}\r\n          onClose={() => {\r\n            setShowCollectModal(false)\r\n            setSelectedAppointment(null)\r\n          }}\r\n          onCollect={handleCollectPayment}\r\n          appointmentData={{\r\n            patientName: selectedAppointment.patients?.name || \"Unknown Patient\",\r\n            service: selectedAppointment.service || \"Treatment\",\r\n            suggestedAmount: calculatedAmount,\r\n          }}\r\n        />\r\n      )}\r\n    </MainLayout>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}