{"version":3,"sources":["../../../../app/hr/payments/page.tsx","../../../../components/modals/record-payment-modal.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useAuth } from \"@/lib/auth-context\"\nimport MainLayout from \"@/components/layout/main-layout\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  LayoutDashboard,\n  Users,\n  Calendar,\n  Bluetooth as Tooth,\n  CreditCard,\n  Package,\n  BarChart3,\n  Settings,\n  Plus,\n  Trash2,\n  Search,\n  CheckCircle,\n  AlertCircle,\n  Download,\n} from \"lucide-react\"\nimport { paymentService, patientService, appointmentService } from \"@/lib/db-service\"\nimport { formatCurrency } from \"@/lib/utils\"\nimport { downloadReceipt, type ReceiptData } from \"@/lib/receipt-generator\"\nimport RecordPaymentModal from \"@/components/modals/record-payment-modal\"\nimport AppointmentPaymentModal from \"@/components/modals/appointment-payment-modal\"\n\ninterface EditingPaymentId {\n  id: string | null\n  field: string | null\n}\n\ninterface Payment {\n  id: string\n  patient_id: string\n  dentist_id?: string\n  amount: number\n  method: string\n  status: \"paid\" | \"partial\" | \"unpaid\"\n  date?: string\n  description?: string\n  patients?: { name: string; email: string }\n  dentists?: { name: string }\n}\n\nexport default function HRPayments() {\n  const { user } = useAuth()\n  const [payments, setPayments] = useState<Payment[]>([])\n  const [patients, setPatients] = useState<any[]>([])\n  const [completedAppointments, setCompletedAppointments] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showRecordModal, setShowRecordModal] = useState(false)\n  const [showAppointmentPaymentModal, setShowAppointmentPaymentModal] = useState(false)\n  const [selectedAppointment, setSelectedAppointment] = useState<any>(null)\n  const [filter, setFilter] = useState(\"all\")\n  const [searchTerm, setSearchTerm] = useState(\"\")\n  const [editingId, setEditingId] = useState<string | null>(null)\n  const [editField, setEditField] = useState<string | null>(null)\n  const [editValue, setEditValue] = useState(\"\")\n\n  useEffect(() => {\n    loadData()\n    // Auto-refresh every 3 seconds to show new payments faster\n    const interval = setInterval(() => {\n      loadData()\n    }, 3000)\n    \n    // Listen for all data change events to refresh immediately\n    const handleDataChange = () => {\n      loadData()\n    }\n    \n    // Register listeners for all data change events\n    window.addEventListener('paymentRecorded', handleDataChange)\n    window.addEventListener('paymentDeleted', handleDataChange)\n    window.addEventListener('appointmentUpdated', handleDataChange)\n    window.addEventListener('dataChanged', handleDataChange) // Generic catch-all\n    \n    return () => {\n      clearInterval(interval)\n      window.removeEventListener('paymentRecorded', handleDataChange)\n      window.removeEventListener('paymentDeleted', handleDataChange)\n      window.removeEventListener('appointmentUpdated', handleDataChange)\n      window.removeEventListener('dataChanged', handleDataChange)\n    }\n  }, [])\n\n  const loadData = async () => {\n    try {\n      console.log(\"[v0] üîÑ Loading payments, patients, and appointments from database...\")\n      setLoading(true)\n      \n      const [paymentsData, patientsData, appointmentsData] = await Promise.all([\n        paymentService.getAll(), \n        patientService.getAll(),\n        appointmentService.getAll()\n      ])\n      \n      console.log(\"[v0] ‚úÖ Loaded\", paymentsData?.length || 0, \"payments\")\n      console.log(\"[v0] ‚úÖ Loaded\", patientsData?.length || 0, \"patients\")\n      console.log(\"[v0] ‚úÖ Loaded\", appointmentsData?.length || 0, \"appointments\")\n      \n      // Filter completed appointments that don't have a payment yet\n      const completed = (appointmentsData || []).filter((apt: any) => {\n        if (apt.status !== \"completed\") return false\n        // Check if there's already a payment for this appointment\n        const hasPayment = (paymentsData || []).some((p: any) => p.appointment_id === apt.id)\n        return !hasPayment\n      })\n      \n      setPayments(paymentsData || [])\n      setPatients(patientsData || [])\n      setCompletedAppointments(completed)\n    } catch (error) {\n      console.error(\"[v0] ‚ùå Error loading data:\", error)\n      console.error(\"[v0] Error details:\", error instanceof Error ? error.message : error)\n      // Set empty arrays on error to prevent UI crashes\n      setPayments([])\n      setPatients([])\n      setCompletedAppointments([])\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const navItems = [\n    { label: \"Dashboard\", icon: <LayoutDashboard className=\"w-5 h-5\" />, href: \"/hr/dashboard\" },\n    { label: \"Patients\", icon: <Users className=\"w-5 h-5\" />, href: \"/hr/patients\" },\n    { label: \"Appointments\", icon: <Calendar className=\"w-5 h-5\" />, href: \"/hr/appointments\" },\n    { label: \"Treatments\", icon: <Tooth className=\"w-5 h-5\" />, href: \"/hr/treatments\" },\n    { label: \"Payments\", icon: <CreditCard className=\"w-5 h-5\" />, href: \"/hr/payments\" },\n    { label: \"Inventory\", icon: <Package className=\"w-5 h-5\" />, href: \"/hr/inventory\" },\n    { label: \"Reports\", icon: <BarChart3 className=\"w-5 h-5\" />, href: \"/hr/reports\" },\n    { label: \"Settings\", icon: <Settings className=\"w-5 h-5\" />, href: \"/hr/settings\" },\n  ]\n\n  const handleRecordPayment = async (data: any) => {\n    try {\n      console.log(\"[v0] üíæ Recording payment to database:\", data)\n      \n      // Create payment in database\n      const newPayment = await paymentService.create(data)\n      \n      if (!newPayment || !newPayment.id) {\n        throw new Error(\"Payment was not saved to database\")\n      }\n      \n      console.log(\"[v0] ‚úÖ Payment saved to database with ID:\", newPayment.id)\n      \n      // If payment is for an appointment, update appointment status to \"paid\"\n      if (data.appointment_id) {\n        try {\n          await appointmentService.update(data.appointment_id, { status: \"paid\" })\n          console.log(\"[v0] ‚úÖ Appointment status updated to paid\")\n        } catch (err) {\n          console.warn(\"[v0] Warning: Could not update appointment status:\", err)\n        }\n      }\n      \n      // Reload all data from database to ensure we have fresh data\n      console.log(\"[v0] üîÑ Reloading all payments from database...\")\n      await loadData()\n      \n      console.log(\"[v0] ‚úÖ Data reloaded successfully\")\n      \n      // Dispatch events to notify other pages\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('paymentRecorded'))\n        window.dispatchEvent(new CustomEvent('dataChanged'))\n      }\n      \n      // Only close modal after everything is saved and loaded\n      setShowRecordModal(false)\n      setShowAppointmentPaymentModal(false)\n      setSelectedAppointment(null)\n      \n      alert(`‚úÖ Payment recorded successfully!\\n\\nAmount: ‚Ç±${data.amount}\\nStatus: ${data.status}\\n\\nPayment is now visible in the system.`)\n    } catch (error) {\n      console.error(\"[v0] ‚ùå Error recording payment:\", error)\n      alert(\"‚ùå Error recording payment: \" + (error instanceof Error ? error.message : \"Unknown error\") + \"\\n\\nPlease try again.\")\n      // Don't close modal on error so user can retry\n    }\n  }\n\n  const handleRecordPaymentFromAppointment = async (paymentData: { method: string; amount: number; notes: string }): Promise<string> => {\n    if (!selectedAppointment) return \"\"\n    \n    try {\n      // Create payment record\n      const payment = await paymentService.create({\n        patient_id: selectedAppointment.patient_id,\n        dentist_id: selectedAppointment.dentist_id || \"\",\n        appointment_id: selectedAppointment.id,\n        amount: paymentData.amount,\n        method: paymentData.method,\n        status: \"paid\",\n        description: paymentData.notes,\n        date: new Date().toISOString().split(\"T\")[0],\n      })\n      \n      // Update appointment status to \"paid\"\n      await appointmentService.update(selectedAppointment.id, {\n        status: \"paid\",\n      })\n      \n      // Reload data to reflect the change\n      await loadData()\n      \n      // Dispatch events to notify other pages\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('paymentRecorded'))\n        window.dispatchEvent(new CustomEvent('dataChanged'))\n      }\n      \n      // Return payment ID for receipt generation\n      return payment.id\n    } catch (error) {\n      console.error(\"[v0] Error recording payment:\", error)\n      throw new Error(\"Failed to record payment: \" + (error instanceof Error ? error.message : \"Unknown error\"))\n    }\n  }\n\n  const handleDeletePayment = async (id: string) => {\n    if (confirm(\"Are you sure you want to delete this payment record?\")) {\n      try {\n        await paymentService.delete(id)\n        setPayments(payments.filter((p) => p.id !== id))\n        \n        // Dispatch events to notify other pages\n        if (typeof window !== 'undefined') {\n          window.dispatchEvent(new CustomEvent('paymentDeleted'))\n          window.dispatchEvent(new CustomEvent('dataChanged'))\n        }\n      } catch (error) {\n        console.error(\"[v0] Error deleting payment:\", error)\n        alert(\"Error deleting payment: \" + (error instanceof Error ? error.message : \"Unknown error\"))\n      }\n    }\n  }\n\n  const handleGenerateReceipt = (payment: Payment) => {\n    const patient = patients.find((p) => p.id === payment.patient_id)\n    const receiptData: ReceiptData = {\n      receiptNumber: payment.id.slice(0, 8).toUpperCase(),\n      date: payment.date ? new Date(payment.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),\n      patientName: patient?.name || payment.patients?.name || \"Unknown Patient\",\n      patientEmail: patient?.email || payment.patients?.email,\n      dentistName: payment.dentists?.name || \"Not Assigned\",\n      service: payment.description || \"Dental Service\",\n      amount: payment.amount,\n      method: payment.method || \"Cash\",\n      notes: payment.description,\n    }\n    downloadReceipt(receiptData)\n  }\n\n  const handleEditPayment = async (id: string, field: string, value: any) => {\n    try {\n      const updatedPayment = await paymentService.update(id, { [field]: value })\n      \n      // Dispatch events to notify other pages\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('paymentUpdated'))\n        window.dispatchEvent(new CustomEvent('dataChanged'))\n      }\n      setPayments(payments.map((p) => (p.id === id ? updatedPayment : p)))\n      setEditingId(null)\n      setEditField(null)\n      setEditValue(\"\")\n    } catch (error) {\n      console.error(\"[v0] Error updating payment:\", error)\n      alert(\"Error updating payment: \" + (error instanceof Error ? error.message : \"Unknown error\"))\n    }\n  }\n\n  const filteredPayments = payments.filter((p) => {\n    const matchesFilter = filter === \"all\" || p.status === filter\n    const patient = patients.find((pt) => pt.id === p.patient_id)\n    const matchesSearch =\n      patient?.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      p.description?.toLowerCase().includes(searchTerm.toLowerCase())\n    return matchesFilter && matchesSearch\n  })\n\n  const totalPaid = payments.filter((p) => p.status === \"paid\").reduce((sum, p) => sum + p.amount, 0)\n  const totalPartial = payments.filter((p) => p.status === \"partial\").reduce((sum, p) => sum + p.amount, 0)\n  const totalUnpaid = payments.filter((p) => p.status === \"unpaid\").reduce((sum, p) => sum + p.amount, 0)\n\n  const paymentStats = {\n    paid: payments.filter((p) => p.status === \"paid\").length,\n    partial: payments.filter((p) => p.status === \"partial\").length,\n    unpaid: payments.filter((p) => p.status === \"unpaid\").length,\n  }\n\n  return (\n    <MainLayout navItems={navItems} title=\"Payment Management\">\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-foreground\">Payment Tracking</h2>\n            <p className=\"text-muted-foreground\">Record and manage patient payments</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button onClick={loadData} variant=\"outline\" size=\"sm\">\n              üîÑ Refresh\n            </Button>\n          </div>\n        </div>\n\n        {/* Completed Appointments Awaiting Payment */}\n        {completedAppointments.length > 0 && (\n          <Card className=\"border-green-300 bg-green-50/50 shadow-lg\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-green-900\">\n                <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                Completed Appointments - Ready for Payment ({completedAppointments.length})\n              </CardTitle>\n              <CardDescription className=\"text-green-700\">\n                Click on any appointment to record payment\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {completedAppointments.map((apt) => (\n                  <button\n                    key={apt.id}\n                    onClick={() => {\n                      setSelectedAppointment(apt)\n                      setShowAppointmentPaymentModal(true)\n                    }}\n                    className=\"p-5 border-2 border-green-300 bg-white rounded-lg hover:bg-green-50 hover:border-green-500 transition-all text-left group\"\n                  >\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <p className=\"font-bold text-lg text-foreground group-hover:text-primary\">\n                          {apt.patients?.name || \"Unknown Patient\"}\n                        </p>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          <span className=\"font-medium\">{apt.service || \"General Visit\"}</span>\n                          {apt.dentists?.name && ` ‚Ä¢ Dr. ${apt.dentists.name}`}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-bold text-primary\">{apt.date}</p>\n                        <p className=\"text-sm text-muted-foreground\">{apt.time}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center justify-between pt-3 border-t border-green-200\">\n                      <span className=\"text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded\">\n                        ‚úì COMPLETED\n                      </span>\n                      {apt.amount && (\n                        <span className=\"text-sm font-bold text-primary\">\n                          Amount: {formatCurrency(apt.amount)}\n                        </span>\n                      )}\n                      <span className=\"text-sm font-bold text-primary group-hover:underline\">\n                        Record Payment ‚Üí\n                      </span>\n                    </div>\n                  </button>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Payment Summary Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Paid</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-green-600\">{formatCurrency(totalPaid)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">{paymentStats.paid} payments</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Partial Payments</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-yellow-600\">{formatCurrency(totalPartial)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">{paymentStats.partial} payments</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Unpaid Balance</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-destructive\">{formatCurrency(totalUnpaid)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">{paymentStats.unpaid} unpaid</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Revenue</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-primary\">{formatCurrency(totalPaid + totalPartial)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">Received so far</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search & Filter */}\n        <Card>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-2.5 w-4 h-4 text-muted-foreground\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Search by patient name or description...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 border-border\"\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              {[\"all\", \"paid\", \"partial\", \"unpaid\"].map((status) => (\n                <button\n                  key={status}\n                  onClick={() => setFilter(status)}\n                  className={`px-4 py-2 rounded-lg font-medium transition-colors text-sm ${\n                    filter === status\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"bg-muted text-foreground hover:bg-muted/80\"\n                  }`}\n                >\n                  {status.charAt(0).toUpperCase() + status.slice(1)}\n                </button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Payments Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Payment Records</CardTitle>\n            <CardDescription>{filteredPayments.length} payment(s) found</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b border-border\">\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Date</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Patient</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Dentist</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Description</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Amount</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Method</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Status</th>\n                    <th className=\"text-left py-3 px-4 font-semibold text-foreground\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredPayments.length === 0 ? (\n                    <tr>\n                      <td colSpan={8} className=\"py-8 text-center text-muted-foreground\">\n                        No payments found\n                      </td>\n                    </tr>\n                  ) : (\n                    filteredPayments.map((payment) => {\n                      const patient = patients.find((p) => p.id === payment.patient_id)\n                      return (\n                        <tr key={payment.id} className=\"border-b border-border hover:bg-muted/50 transition-colors\">\n                          <td className=\"py-3 px-4 text-sm text-muted-foreground\">\n                            {payment.date ? new Date(payment.date).toLocaleDateString() : \"-\"}\n                          </td>\n                          <td className=\"py-3 px-4 text-sm font-medium text-foreground\">\n                            {patient?.name || \"Unknown\"}\n                          </td>\n                          <td className=\"py-3 px-4 text-sm text-muted-foreground\">{payment.dentists?.name || \"-\"}</td>\n                          <td className=\"py-3 px-4 text-sm text-muted-foreground\">{payment.description || \"-\"}</td>\n                          <td className=\"py-3 px-4 text-sm font-semibold text-foreground\">\n                            {formatCurrency(payment.amount)}\n                          </td>\n                          <td className=\"py-3 px-4 text-sm text-muted-foreground\">{payment.method || \"-\"}</td>\n                          <td className=\"py-3 px-4\">\n                            {editingId === payment.id && editField === \"status\" ? (\n                              <select\n                                value={editValue}\n                                onChange={(e) => setEditValue(e.target.value)}\n                                onBlur={() => handleEditPayment(payment.id, \"status\", editValue)}\n                                className=\"px-2 py-1 border border-border rounded text-xs bg-background text-foreground\"\n                                autoFocus\n                              >\n                                <option value=\"paid\">Paid</option>\n                                <option value=\"partial\">Partial</option>\n                                <option value=\"unpaid\">Unpaid</option>\n                              </select>\n                            ) : (\n                              <button\n                                onClick={() => {\n                                  setEditingId(payment.id)\n                                  setEditField(\"status\")\n                                  setEditValue(payment.status)\n                                }}\n                                className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold cursor-pointer hover:opacity-80 transition-opacity ${\n                                  payment.status === \"paid\"\n                                    ? \"bg-green-100 text-green-700\"\n                                    : payment.status === \"partial\"\n                                      ? \"bg-yellow-100 text-yellow-700\"\n                                      : \"bg-red-100 text-red-700\"\n                                }`}\n                              >\n                                {payment.status === \"paid\" ? (\n                                  <CheckCircle className=\"w-3 h-3\" />\n                                ) : (\n                                  <AlertCircle className=\"w-3 h-3\" />\n                                )}\n                                {payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}\n                              </button>\n                            )}\n                          </td>\n                          <td className=\"py-3 px-4\">\n                            <div className=\"flex items-center gap-2\">\n                              <button\n                                onClick={() => handleGenerateReceipt(payment)}\n                                className=\"p-1.5 hover:bg-primary/10 rounded-lg transition-colors text-primary\"\n                                title=\"Download receipt\"\n                              >\n                                <Download className=\"w-4 h-4\" />\n                              </button>\n                              <button\n                                onClick={() => handleDeletePayment(payment.id)}\n                                className=\"p-1.5 hover:bg-destructive/10 rounded-lg transition-colors text-destructive\"\n                                title=\"Delete payment\"\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </button>\n                            </div>\n                          </td>\n                        </tr>\n                      )\n                    })\n                  )}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {loading ? (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center text-muted-foreground\">Loading payments...</div>\n          </CardContent>\n        </Card>\n      ) : (\n        <>\n          {showRecordModal && (\n            <RecordPaymentModal onClose={() => setShowRecordModal(false)} onSubmit={handleRecordPayment} />\n          )}\n          {showAppointmentPaymentModal && selectedAppointment && (\n            <AppointmentPaymentModal\n              appointment={selectedAppointment}\n              onClose={() => {\n                setShowAppointmentPaymentModal(false)\n                setSelectedAppointment(null)\n              }}\n              onRecordPayment={handleRecordPaymentFromAppointment}\n            />\n          )}\n        </>\n      )}\n    </MainLayout>\n  )\n}\n","\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { X } from \"lucide-react\"\r\nimport { patientService, dentistService } from \"@/lib/db-service\"\r\n\r\ninterface RecordPaymentModalProps {\r\n  onClose: () => void\r\n  onSubmit: (data: any) => void\r\n}\r\n\r\ninterface Patient {\r\n  id: string\r\n  name: string\r\n}\r\n\r\ninterface Dentist {\r\n  id: string\r\n  name: string\r\n}\r\n\r\nexport default function RecordPaymentModal({ onClose, onSubmit }: RecordPaymentModalProps) {\r\n  const [formData, setFormData] = useState({\r\n    patient_id: \"\",\r\n    dentist_id: \"\",\r\n    amount: \"\",\r\n    method: \"Cash\",\r\n    status: \"paid\",\r\n    description: \"\",\r\n  })\r\n  const [patients, setPatients] = useState<Patient[]>([])\r\n  const [dentists, setDentists] = useState<Dentist[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    loadData()\r\n  }, [])\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const [patientsData, dentistsData] = await Promise.all([patientService.getAll(), dentistService.getAll()])\r\n      setPatients(patientsData || [])\r\n      setDentists(dentistsData || [])\r\n    } catch (error) {\r\n      console.error(\"Error loading data:\", error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target\r\n    setFormData((prev) => ({ ...prev, [name]: value }))\r\n  }\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    if (formData.patient_id && formData.amount && formData.description && formData.dentist_id) {\r\n      onSubmit({\r\n        patient_id: formData.patient_id,\r\n        dentist_id: formData.dentist_id,\r\n        amount: Number.parseFloat(formData.amount),\r\n        method: formData.method,\r\n        status: formData.status,\r\n        description: formData.description,\r\n        date: new Date().toISOString().split(\"T\")[0],\r\n      })\r\n      setFormData({ patient_id: \"\", dentist_id: \"\", amount: \"\", method: \"Cash\", status: \"paid\", description: \"\" })\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-card rounded-lg shadow-2xl max-w-md w-full max-h-96 overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-border sticky top-0 bg-card\">\r\n          <h2 className=\"text-xl font-bold text-foreground\">Record Payment</h2>\r\n          <button onClick={onClose} className=\"p-1 hover:bg-muted rounded-lg transition-colors\">\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Patient *</label>\r\n            {loading ? (\r\n              <div className=\"text-sm text-muted-foreground\">Loading...</div>\r\n            ) : (\r\n              <select\r\n                name=\"patient_id\"\r\n                value={formData.patient_id}\r\n                onChange={handleInputChange}\r\n                className=\"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground\"\r\n                required\r\n              >\r\n                <option value=\"\">Select patient...</option>\r\n                {patients.map((p) => (\r\n                  <option key={p.id} value={p.id}>\r\n                    {p.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Dentist *</label>\r\n            {loading ? (\r\n              <div className=\"text-sm text-muted-foreground\">Loading...</div>\r\n            ) : (\r\n              <select\r\n                name=\"dentist_id\"\r\n                value={formData.dentist_id}\r\n                onChange={handleInputChange}\r\n                className=\"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground\"\r\n                required\r\n              >\r\n                <option value=\"\">Select dentist...</option>\r\n                {dentists.map((d) => (\r\n                  <option key={d.id} value={d.id}>\r\n                    {d.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Amount (‚Ç±) *</label>\r\n            <Input\r\n              name=\"amount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              value={formData.amount}\r\n              onChange={handleInputChange}\r\n              placeholder=\"0.00\"\r\n              className=\"border-border\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Payment Method</label>\r\n            <select\r\n              name=\"method\"\r\n              value={formData.method}\r\n              onChange={handleInputChange}\r\n              className=\"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground\"\r\n            >\r\n              <option>Cash</option>\r\n              <option>Bank Transfer</option>\r\n              <option>Credit Card</option>\r\n              <option>Check</option>\r\n              <option>Insurance</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Status</label>\r\n            <select\r\n              name=\"status\"\r\n              value={formData.status}\r\n              onChange={handleInputChange}\r\n              className=\"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground\"\r\n            >\r\n              <option value=\"paid\">Paid</option>\r\n              <option value=\"partial\">Partial</option>\r\n              <option value=\"unpaid\">Unpaid</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium text-foreground\">Description *</label>\r\n            <textarea\r\n              name=\"description\"\r\n              value={formData.description}\r\n              onChange={handleInputChange}\r\n              placeholder=\"e.g., Cleaning - Dec 5, 2024\"\r\n              className=\"w-full p-2 border border-border rounded-lg text-sm resize-none bg-background text-foreground\"\r\n              rows={2}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button type=\"button\" onClick={onClose} variant=\"outline\" className=\"flex-1 bg-transparent\">\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              className=\"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground\"\r\n              disabled={loading}\r\n            >\r\n              Record Payment\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,MAAA,EAAA,EAAA,CAAA,CAAA,OAgBA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCrBA,EAAA,EAAA,CAAA,CAAA,OAkBe,SAAS,EAAmB,SAAE,CAAO,UAAE,CAAQ,CAA2B,EACvF,GAAM,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CACvC,WAAY,GACZ,WAAY,GACZ,OAAQ,GACR,OAAQ,OACR,OAAQ,OACR,YAAa,EACf,GACM,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,EAAE,EAChD,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,EAAE,EAChD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEvC,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GACF,EAAG,EAAE,EAEL,IAAM,EAAW,UACf,GAAI,CACF,GAAW,GACX,GAAM,CAAC,EAAc,EAAa,CAAG,MAAM,QAAQ,GAAG,CAAC,CAAC,EAAA,cAAc,CAAC,MAAM,GAAI,EAAA,cAAc,CAAC,MAAM,GAAG,EACzG,EAAY,GAAgB,EAAE,EAC9B,EAAY,GAAgB,EAAE,CAChC,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,sBAAuB,EACvC,QAAU,CACR,GAAW,EACb,CACF,EAEM,EAAoB,AAAC,IACzB,GAAM,CAAE,MAAI,OAAE,CAAK,CAAE,CAAG,EAAE,MAAM,CAChC,EAAY,AAAC,IAAU,CAAE,EAAH,CAAM,CAAI,CAAE,CAAC,EAAK,CAAE,EAAM,CAAC,CACnD,EAkBA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+EACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mFAEb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8FACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,mBAClD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,QAAS,EAAS,UAAU,2DAClC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAC,CAAA,CAAC,UAAU,iBAKjB,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SA5BS,AAAC,CA4BA,GA3BpB,EAAE,cAAc,GACZ,EAAS,UAAU,EAAI,EAAS,MAAM,EAAI,EAAS,WAAW,EAAI,EAAS,UAAU,EAAE,CACzF,EAAS,CACP,WAAY,EAAS,UAAU,CAC/B,WAAY,EAAS,UAAU,CAC/B,OAAQ,OAAO,UAAU,CAAC,EAAS,MAAM,EACzC,OAAQ,EAAS,MAAM,CACvB,OAAQ,EAAS,MAAM,CACvB,YAAa,EAAS,WAAW,CACjC,KAAM,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,AAC9C,GACA,EAAY,CAAE,WAAY,GAAI,WAAY,GAAI,OAAQ,GAAI,OAAQ,OAAQ,OAAQ,OAAQ,YAAa,EAAG,GAE9G,EAcoC,UAAU,0BACtC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,cACtD,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCAAgC,eAE/C,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,KAAK,aACL,MAAO,EAAS,UAAU,CAC1B,SAAU,EACV,UAAU,iFACV,QAAQ,CAAA,CAAA,YAER,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,YAAG,sBAChB,EAAS,GAAG,CAAC,AAAC,GACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAkB,MAAO,EAAE,EAAE,UAC3B,EAAE,IAAI,EADI,EAAE,EAAE,SAQzB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,cACtD,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCAAgC,eAE/C,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,KAAK,aACL,MAAO,EAAS,UAAU,CAC1B,SAAU,EACV,UAAU,iFACV,QAAQ,CAAA,CAAA,YAER,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,YAAG,sBAChB,EAAS,GAAG,CAAC,AAAC,GACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAkB,MAAO,EAAE,EAAE,UAC3B,EAAE,IAAI,EADI,EAAE,EAAE,SAQzB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,iBACvD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,KAAK,SACL,KAAK,SACL,KAAK,OACL,MAAO,EAAS,MAAM,CACtB,SAAU,EACV,YAAY,OACZ,UAAU,gBACV,QAAQ,CAAA,CAAA,OAIZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,mBACvD,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,KAAK,SACL,MAAO,EAAS,MAAM,CACtB,SAAU,EACV,UAAU,2FAEV,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,SACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,kBACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,gBACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,UACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,oBAIZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,WACvD,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,KAAK,SACL,MAAO,EAAS,MAAM,CACtB,SAAU,EACV,UAAU,2FAEV,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,gBAAO,SACrB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,mBAAU,YACxB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,kBAAS,iBAI3B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,+CAAsC,kBACvD,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CACC,KAAK,cACL,MAAO,EAAS,WAAW,CAC3B,SAAU,EACV,YAAY,+BACZ,UAAU,+FACV,KAAM,EACN,QAAQ,CAAA,CAAA,OAIZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4BACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,KAAK,SAAS,QAAS,EAAS,QAAQ,UAAU,UAAU,iCAAwB,WAG5F,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,UAAU,gEACV,SAAU,WACX,6BAQb,CDhLA,IAAA,EAAA,EAAA,CAAA,CAAA,OAoBe,SAAS,IACtB,GAAM,MAAE,CAAI,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IAClB,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,EAAE,EAChD,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAQ,EAAE,EAC5C,CAAC,EAAuB,EAAyB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAQ,EAAE,EACtE,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,GAAS,GACjC,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjD,CAAC,EAA6B,EAA+B,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzE,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAM,MAC9D,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,OAC/B,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACvC,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACpD,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACpD,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAE3C,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAEA,IAAM,EAAW,YAAY,KAC3B,GACF,EAAG,KAGG,EAAmB,KACvB,GACF,EAQA,OALA,OAAO,gBAAgB,CAAC,kBAAmB,GAC3C,OAAO,gBAAgB,CAAC,iBAAkB,GAC1C,OAAO,gBAAgB,CAAC,qBAAsB,GAC9C,OAAO,gBAAgB,CAAC,cAAe,GAEhC,KACL,WAHuD,GAGzC,GACd,OAAO,OAJoE,YAIjD,CAAC,kBAAmB,GAC9C,OAAO,mBAAmB,CAAC,iBAAkB,GAC7C,OAAO,mBAAmB,CAAC,qBAAsB,GACjD,OAAO,mBAAmB,CAAC,cAAe,EAC5C,CACF,EAAG,EAAE,EAEL,IAAM,EAAW,UACf,GAAI,CACF,QAAQ,GAAG,CAAC,yEACZ,GAAW,GAEX,GAAM,CAAC,EAAc,EAAc,EAAiB,CAAG,MAAM,QAAQ,GAAG,CAAC,CACvE,EAAA,cAAc,CAAC,MAAM,GACrB,EAAA,cAAc,CAAC,MAAM,GACrB,EAAA,kBAAkB,CAAC,MAAM,GAC1B,EAED,QAAQ,GAAG,CAAC,gBAAiB,GAAc,QAAU,EAAG,YACxD,QAAQ,GAAG,CAAC,gBAAiB,GAAc,QAAU,EAAG,YACxD,QAAQ,GAAG,CAAC,gBAAiB,GAAkB,QAAU,EAAG,gBAG5D,IAAM,EAAY,CAAC,GAAoB,EAAA,AAAE,EAAE,MAAM,CAAC,AAAC,GACjD,AAAmB,aAAa,CAA5B,EAAI,IAA+B,EAAzB,EAGP,CAAC,AADW,CAAC,GAAgB,EAAA,AAAE,EAAE,IAAI,CAAE,AAAD,GAAY,EAAE,cAAc,GAAK,EAAI,EAAE,GAItF,EAAY,GAAgB,EAAE,EAC9B,EAAY,GAAgB,EAAE,EAC9B,EAAyB,EAC3B,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,6BAA8B,GAC5C,QAAQ,KAAK,CAAC,sBAAuB,aAAiB,MAAQ,EAAM,OAAO,CAAG,GAE9E,EAAY,EAAE,EACd,EAAY,EAAE,EACd,EAAyB,EAAE,CAC7B,QAAU,CACR,GAAW,EACb,CACF,EAEM,EAAW,CACf,CAAE,MAAO,YAAa,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,YAAc,KAAM,eAAgB,EAC3F,CAAE,MAAO,WAAY,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,YAAc,KAAM,cAAe,EAC/E,CAAE,MAAO,eAAgB,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,YAAc,KAAM,kBAAmB,EAC1F,CAAE,MAAO,aAAc,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAK,CAAA,CAAC,UAAU,YAAc,KAAM,gBAAiB,EACnF,CAAE,MAAO,WAAY,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,YAAc,KAAM,cAAe,EACpF,CAAE,MAAO,YAAa,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,UAAU,YAAc,KAAM,eAAgB,EACnF,CAAE,MAAO,UAAW,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,YAAc,KAAM,aAAc,EACjF,CAAE,MAAO,WAAY,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,YAAc,KAAM,cAAe,EACnF,CAEK,EAAsB,MAAO,IACjC,GAAI,CACF,QAAQ,GAAG,CAAC,yCAA0C,GAGtD,IAAM,EAAa,MAAM,EAAA,cAAc,CAAC,MAAM,CAAC,GAE/C,GAAI,CAAC,GAAc,CAAC,EAAW,EAAE,CAC/B,CADiC,KAC3B,AAAI,MAAM,qCAMlB,GAHA,QAAQ,GAAG,CAAC,4CAA6C,EAAW,EAAE,EAGlE,EAAK,cAAc,CACrB,CADuB,EACnB,CACF,MAAM,EAAA,kBAAkB,CAAC,MAAM,CAAC,EAAK,cAAc,CAAE,CAAE,OAAQ,MAAO,GACtE,QAAQ,GAAG,CAAC,4CACd,CAAE,MAAO,EAAK,CACZ,QAAQ,IAAI,CAAC,qDAAsD,EACrE,CAIF,QAAQ,GAAG,CAAC,mDACZ,MAAM,IAEN,QAAQ,GAAG,CAAC,qCASZ,GAAmB,GACnB,GAA+B,GAC/B,EAAuB,MAEvB,MAAM,CAAC;AAAA;AAAA,SAA6C,EAAE,EAAK,MAAM,CAAC;AAAA,QAAU,EAAE,EAAK,MAAM,CAAC;AAAA;AAAA,qCAAyC,CAAC,CACtI,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,kCAAmC,GACjD,MAAM,8BAAiC,EAAD,YAAkB,MAAQ,EAAM,OAAO,CAAG,eAAA,CAAe,CAAI,wBAErG,CACF,EAEM,EAAqC,MAAO,IAChD,GAAI,CAAC,EAAqB,MAAO,GAEjC,GAAI,CAEF,IAAM,EAAU,MAAM,EAAA,cAAc,CAAC,MAAM,CAAC,CAC1C,WAAY,EAAoB,UAAU,CAC1C,WAAY,EAAoB,UAAU,EAAI,GAC9C,eAAgB,EAAoB,EAAE,CACtC,OAAQ,EAAY,MAAM,CAC1B,OAAQ,EAAY,MAAM,CAC1B,OAAQ,OACR,YAAa,EAAY,KAAK,CAC9B,KAAM,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,AAC9C,GAiBA,OAdA,MAAM,EAAA,kBAAkB,CAAC,MAAM,CAAC,EAAoB,EAAE,CAAE,CACtD,OAAQ,MACV,GAGA,MAAM,IASC,EAAQ,EAAE,AACnB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,gCAAiC,GACzC,AAAI,MAAM,8BAAgC,CAAD,YAAkB,MAAQ,EAAM,OAAO,CAAG,eAAA,CAAe,CAC1G,CACF,EAEM,GAAsB,MAAO,IACjC,GAAI,QAAQ,wDACV,CADmE,EAC/D,CACF,MAAM,EAAA,cAAc,CAAC,MAAM,CAAC,GAC5B,EAAY,EAAS,MAAM,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,GAO9C,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,+BAAgC,GAC9C,MAAM,4BAA8B,CAAD,YAAkB,MAAQ,EAAM,OAAO,CAAG,eAAA,CAAe,CAC9F,CAEJ,EAkBM,GAAoB,MAAO,EAAY,EAAe,KAC1D,GAAI,CACF,IAAM,EAAiB,MAAM,EAAA,cAAc,CAAC,MAAM,CAAC,EAAI,CAAE,CAAC,EAAM,CAAE,CAAM,GAOxE,EAAY,EAAS,GAAG,CAAC,AAAC,GAAO,EAAE,EAAE,GAAK,EAAK,EAAiB,IAChE,EAAa,MACb,EAAa,MACb,EAAa,GACf,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,+BAAgC,GAC9C,MAAM,4BAA8B,CAAD,YAAkB,MAAQ,EAAM,OAAO,CAAG,eAAA,CAAe,CAC9F,CACF,EAEM,GAAmB,EAAS,MAAM,CAAC,AAAC,IACxC,IAAM,EAA2B,QAAX,GAAoB,EAAE,MAAM,GAAK,EACjD,EAAU,EAAS,IAAI,CAAC,AAAC,GAAO,EAAG,EAAE,GAAK,EAAE,UAAU,EACtD,EACJ,GAAS,KAAK,cAAc,SAAS,EAAW,WAAW,KAC3D,EAAE,WAAW,EAAE,cAAc,SAAS,EAAW,WAAW,IAC9D,OAAO,GAAiB,CAC1B,GAEM,GAAY,EAAS,MAAM,CAAC,AAAC,GAAmB,SAAb,EAAE,MAAM,EAAa,MAAM,CAAC,CAAC,EAAK,IAAM,EAAM,EAAE,MAAM,CAAE,GAC3F,GAAe,EAAS,MAAM,CAAC,AAAC,GAAmB,YAAb,EAAE,MAAM,EAAgB,MAAM,CAAC,CAAC,EAAK,IAAM,EAAM,EAAE,MAAM,CAAE,GACjG,GAAc,EAAS,MAAM,CAAC,AAAC,GAAmB,WAAb,EAAE,MAAM,EAAe,MAAM,CAAC,CAAC,EAAK,IAAM,EAAM,EAAE,MAAM,CAAE,GAE/F,GAAe,CACnB,KAAM,EAAS,MAAM,CAAC,AAAC,GAAmB,SAAb,EAAE,MAAM,EAAa,MAAM,CACxD,QAAS,EAAS,MAAM,CAAC,AAAC,GAAmB,YAAb,EAAE,MAAM,EAAgB,MAAM,CAC9D,OAAQ,EAAS,MAAM,CAAC,AAAC,GAAM,AAAa,aAAX,MAAM,EAAe,MAAM,AAC9D,EAEA,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,OAAU,CAAA,CAAC,SAAU,EAAU,MAAM,+BACpC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBAEb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,qBACnD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,0CAEvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAS,EAAU,QAAQ,UAAU,KAAK,cAAK,oBAO1D,EAAsB,MAAM,CAAG,GAC9B,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,sDACd,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,WACT,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,mDACnB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,2BAA2B,+CACL,EAAsB,MAAM,CAAC,OAE5E,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,0BAAiB,kDAI9C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iDACZ,EAAsB,GAAG,CAAC,AAAC,GAC1B,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAEC,QAAS,KACP,EAAuB,GACvB,GAA+B,EACjC,EACA,UAAU,sIAEV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sEACV,EAAI,QAAQ,EAAE,MAAQ,oBAEzB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,+CACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAe,EAAI,OAAO,EAAI,kBAC7C,EAAI,QAAQ,EAAE,MAAQ,CAAC,OAAO,EAAE,EAAI,QAAQ,CAAC,IAAI,CAAA,CAAE,OAGxD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,kCAA0B,EAAI,IAAI,GAC/C,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yCAAiC,EAAI,IAAI,SAG1D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6EACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+EAAsE,gBAGrF,EAAI,MAAM,EACT,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,2CAAiC,WACtC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,EAAI,MAAM,KAGtC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,gEAAuD,0BA/BpE,EAAI,EAAE,UA2CvB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8CACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,gBACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qDAA4C,iBAEnE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CAAqC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,MACnE,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,+CAAsC,GAAa,IAAI,CAAC,qBAIzE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8CACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,gBACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qDAA4C,uBAEnE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CAAsC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,MACpE,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,+CAAsC,GAAa,OAAO,CAAC,qBAI5E,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8CACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,gBACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qDAA4C,qBAEnE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CAAuC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,MACrE,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,+CAAsC,GAAa,MAAM,CAAC,mBAI3E,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,8CACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,gBACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,qDAA4C,oBAEnE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2CAAmC,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,GAAY,MAC7E,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8CAAqC,6BAMxD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,2BACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,UAAU,0DAClB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,KAAK,OACL,YAAY,2CACZ,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAC7C,UAAU,2BAId,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,CAAC,MAAO,OAAQ,UAAW,SAAS,CAAC,GAAG,CAAC,AAAC,GACzC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAEC,QAAS,IAAM,EAAU,GACzB,UAAW,CAAC,2DAA2D,EACrE,IAAW,EACP,qCACA,6CAAA,CACJ,UAED,EAAO,MAAM,CAAC,GAAG,WAAW,GAAK,EAAO,KAAK,CAAC,IAR1C,WAgBf,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACH,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,WACT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAC,oBACX,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,eAAe,CAAA,WAAE,GAAiB,MAAM,CAAC,0BAE5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,mBACf,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UACC,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,mCACZ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,SAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,YAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,YAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,gBAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,WAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,WAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,WAClE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6DAAoD,iBAGtE,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UAC8B,IAA5B,GAAiB,MAAM,CACtB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,QAAS,EAAG,UAAU,kDAAyC,wBAKrE,GAAiB,GAAG,CAAC,AAAC,IACpB,IAAM,EAAU,EAAS,IAAI,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,EAAQ,UAAU,EAChE,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAoB,UAAU,uEAC7B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mDACX,EAAQ,IAAI,CAAG,IAAI,KAAK,EAAQ,IAAI,EAAE,kBAAkB,GAAK,MAEhE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,yDACX,GAAS,MAAQ,YAEpB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mDAA2C,EAAQ,QAAQ,EAAE,MAAQ,MACnF,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mDAA2C,EAAQ,WAAW,EAAI,MAChF,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,2DACX,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,EAAQ,MAAM,IAEhC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mDAA2C,EAAQ,MAAM,EAAI,MAC3E,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qBACX,IAAc,EAAQ,EAAE,EAAkB,WAAd,EAC3B,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,MAAO,EACP,SAAU,AAAC,GAAM,EAAa,EAAE,MAAM,CAAC,KAAK,EAC5C,OAAQ,IAAM,GAAkB,EAAQ,EAAE,CAAE,SAAU,GACtD,UAAU,+EACV,SAAS,CAAA,CAAA,YAET,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,gBAAO,SACrB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,mBAAU,YACxB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,kBAAS,cAGzB,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,QAAS,KACP,EAAa,EAAQ,EAAE,EACvB,EAAa,UACb,EAAa,EAAQ,MAAM,CAC7B,EACA,UAAW,CAAC,+HAA+H,EACtH,SAAnB,EAAQ,MAAM,CACV,8BACmB,YAAnB,EAAQ,MAAM,CACZ,gCACA,0BAAA,CACN,WAEkB,SAAnB,EAAQ,MAAM,CACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,YAEvB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,YAExB,EAAQ,MAAM,CAAC,MAAM,CAAC,GAAG,WAAW,GAAK,EAAQ,MAAM,CAAC,KAAK,CAAC,QAIrE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qBACZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,OA9RrC,SADA,EAAU,EAAS,IAAI,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,EAAQ,UAAU,IAC/B,CAC/B,cAAe,EAAQ,EAAE,CAAC,KAAK,CAAC,EAAG,GAAG,WAAW,GACjD,KA4R+D,AA5RzD,EAAQ,IAAI,CAAG,IAAI,KAAK,EAAQ,IAAI,EAAE,kBAAkB,CAAC,QAAS,CAAE,KAAM,UAAW,MAAO,OAAQ,IAAK,SAAU,GAAK,IAAI,OAAO,kBAAkB,CAAC,QAAS,CAAE,KAAM,UAAW,MAAO,OAAQ,IAAK,SAAU,GACtN,YAAa,GAAS,MAAQ,EAAQ,QAAQ,EAAE,MAAQ,kBACxD,aAAc,GAAS,OAAS,EAAQ,QAAQ,EAAE,MAClD,YAAa,EAAQ,QAAQ,EAAE,MAAQ,eACvC,QAAS,EAAQ,WAAW,EAAI,iBAChC,OAAQ,EAAQ,MAAM,CACtB,OAAQ,EAAQ,MAAM,EAAI,OAC1B,MAAO,EAAQ,WACjB,AAD4B,MAE5B,CAAA,EAAA,EAAA,eAAA,AAAe,EAAC,IAoRY,UAAU,sEACV,MAAM,4BAEN,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,cAEtB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,GAAoB,EAAQ,EAAE,EAC7C,UAAU,8EACV,MAAM,0BAEN,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,UAAU,qBAhEjB,EAAQ,EAAE,CAsEvB,kBASb,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,gBACrB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CAAoC,4BAIvD,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACG,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAmB,QAAS,IAAM,GAAmB,GAAQ,SAAU,IAEzE,GAA+B,GAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAuB,CAAA,CACtB,YAAa,EACb,QAAS,KACP,GAA+B,GAC/B,EAAuB,KACzB,EACA,gBAAiB,SAO/B"}