module.exports=[72351,a=>{"use strict";var b=a.i(87924),c=a.i(21937),d=a.i(96313),e=a.i(3130),f=a.i(40695),g=a.i(30617),h=a.i(41675),i=a.i(34422),j=a.i(39761),k=a.i(16201),l=a.i(62722),m=a.i(90166),n=a.i(72131),o=a.i(2288),p=a.i(21447);function q(){let{user:a}=(0,c.useAuth)(),[q,r]=(0,n.useState)([]),[s,t]=(0,n.useState)(null),[u,v]=(0,n.useState)(!0),[w,x]=(0,n.useState)(null),[y,z]=(0,n.useState)(!1),[A,B]=(0,n.useState)(null),[C,D]=(0,n.useState)(0),[E,F]=(0,n.useState)({totalAppointments:0,completed:0,pending:0,earnings:0});(0,n.useEffect)(()=>{G();let a=setInterval(()=>{G()},3e3);return()=>clearInterval(a)},[a?.email]);let G=async()=>{if(a?.email)try{let b=await o.dentistService.getAll(),c=(b||[]).find(b=>b.user_id===a.id),d=(b||[]).find(b=>(b.email||"").toLowerCase()===(a.email||"").toLowerCase()),e=c||d;e?.id?(t(e.id),await H(e.id)):(t(null),r([]))}catch(a){console.error("[v0] Error loading dentist record:",a),r([])}},H=async a=>{let b=a||s;if(b)try{v(!0);let a=await o.appointmentService.getByDentistId(b);r(a||[]);let c=(a||[]).filter(a=>"completed"===a.status).length,d=(a||[]).filter(a=>"pending"===a.status).length;try{let e=(await o.paymentService.getByDentistId(b)||[]).filter(a=>"paid"===a.status||"partial"===a.status).reduce((a,b)=>a+(b.amount||0),0);F({totalAppointments:(a||[]).length,completed:c,pending:d,earnings:e})}catch(b){console.log("[v0] Could not load earnings from payments (this is OK):",b),F({totalAppointments:(a||[]).length,completed:c,pending:d,earnings:0})}}catch(a){console.error("[v0] Error loading appointments:",a)}finally{v(!1)}},I=async a=>{x(a);try{await o.appointmentService.changeStatus(a,"confirmed"),r(b=>b.map(b=>b.id===a?{...b,status:"confirmed"}:b))}catch(a){console.error("[v0] Error approving appointment:",a),alert("Failed to approve appointment")}finally{x(null)}},J=async a=>{x(a.id);try{await o.appointmentService.changeStatus(a.id,"completed"),r(b=>b.map(b=>b.id===a.id?{...b,status:"completed"}:b));let b=a.amount||0;if(!b&&a.treatment_id)try{let c=await o.treatmentService.getById(a.treatment_id);b=c?.price||0}catch(a){console.warn("[v0] Could not resolve treatment by id:",a)}if(!b)try{let c=(await o.treatmentService.getAll()||[]).find(b=>b.name===(a.service||a.treatment));b=c?.price||0}catch(a){console.warn("[v0] Could not lookup treatments:",a)}b||(b=({Cleaning:500,"Tooth Cleaning":500,"Dental Cleaning":500,Filling:800,"Dental Filling":800,"Tooth Filling":800,"Root Canal":1500,"Root Canal Treatment":1500,Extraction:600,"Tooth Extraction":600,Whitening:2e3,"Teeth Whitening":2e3,Checkup:300,"Dental Checkup":300,Consultation:300,Braces:3e3,"Dental Braces":3e3,Crown:2500,"Dental Crown":2500})[a.service]||500),console.log("[v0] Calculated amount:",b,"for service:",a.service),B(a),D(b),z(!0)}catch(a){console.error("[v0] Error completing appointment:",a),alert("Failed to complete appointment")}finally{x(null)}},K=async a=>{if(A)try{console.log("[v0] Collecting payment:",a);let b={patient_id:A.patient_id,dentist_id:"string"==typeof A.dentist_id?A.dentist_id:s,appointment_id:A.id,amount:a.amount,method:a.method,status:"paid",description:`${A.service||"treatment"} - ${a.notes||"Payment collected"}`,date:new Date().toISOString().split("T")[0]},c="string"==typeof b.dentist_id?b.dentist_id:null;if(!c){console.error("[v0] Missing dentist_id when collecting payment from dashboard"),alert("Cannot record payment: dentist id is missing. Please reopen after reloading your dashboard.");return}b.dentist_id=c;let d=await o.paymentService.create(b);console.log("[v0] âœ… Payment saved to database:",d),z(!1),B(null),alert(`âœ… PAYMENT COLLECTED SUCCESSFULLY!

ðŸ’µ Amount: â‚±${a.amount.toLocaleString()}
ðŸ’³ Method: ${a.method.replace(/_/g," ").toUpperCase()}
ðŸ‘¨â€âš•ï¸ Your Share (50%): â‚±${(.5*a.amount).toLocaleString()}

ðŸ“Š Payment ID: ${d.id}

âœ“ Recorded in database
âœ“ Will appear in your Earnings
âœ“ Visible to HR in Payments section`),H()}catch(b){console.error("[v0] Error recording payment:",b);let a=b instanceof Error?b.message:String(b);alert(`âŒ Payment collection failed!

Error: ${a}

Please try again or contact support.`)}},L=async a=>{x(a);try{await o.appointmentService.changeStatus(a,"rejected"),r(b=>b.map(b=>b.id===a?{...b,status:"rejected"}:b))}catch(a){console.error("[v0] Error rejecting appointment:",a),alert("Failed to reject appointment")}finally{x(null)}},M=q.filter(a=>"pending"===a.status),N=q.filter(a=>"confirmed"===a.status||"attended"===a.status),O=N.filter(a=>{let b=new Date().toISOString().split("T")[0];return a.date===b}),P=[{label:"Dashboard",icon:(0,b.jsx)(g.LayoutDashboard,{className:"w-5 h-5"}),href:"/dentist/dashboard"},{label:"My Schedule",icon:(0,b.jsx)(h.Calendar,{className:"w-5 h-5"}),href:"/dentist/schedule"},{label:"Treatments",icon:(0,b.jsx)(i.Bluetooth,{className:"w-5 h-5"}),href:"/dentist/treatments"},{label:"Earnings",icon:(0,b.jsx)(m.DollarSign,{className:"w-5 h-5"}),href:"/dentist/earnings"},{label:"Reports",icon:(0,b.jsx)(j.BarChart3,{className:"w-5 h-5"}),href:"/dentist/reports"}];return(0,b.jsxs)(d.default,{navItems:P,title:"Dentist Schedule",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-primary to-accent rounded-lg p-6 text-primary-foreground",children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Welcome, ",a?.name]}),(0,b.jsx)("p",{className:"opacity-90",children:"Manage your appointments and patient treatments"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(e.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Today's Appointments"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-primary",children:O.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"All confirmed"})]})]}),(0,b.jsxs)(e.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approvals"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:M.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting action"})]})]}),(0,b.jsxs)(e.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"This Week"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-primary",children:N.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total appointments"})]})]}),(0,b.jsxs)(e.Card,{className:"hover:shadow-md transition-shadow",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"ðŸ’µ Total Earnings"})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:["â‚±",(E.earnings||0).toLocaleString()]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"From completed appointments"})]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Pending Appointment Approvals"}),(0,b.jsx)(e.CardDescription,{children:"Appointments awaiting your decision"})]}),(0,b.jsx)(e.CardContent,{children:u?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading appointments..."}):0===M.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No pending appointments"}):(0,b.jsx)("div",{className:"space-y-3",children:M.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-sm font-semibold text-primary",children:a.patients?.name?a.patients.name.charAt(0):"?"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:a.patients?.name||"Unknown Patient"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.date," at ",a.time]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>I(a.id),disabled:w===a.id,children:[(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4 mr-1"}),w===a.id?"...":"Accept"]}),(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",className:"border-destructive text-destructive hover:bg-destructive/10 bg-transparent",onClick:()=>L(a.id),disabled:w===a.id,children:[(0,b.jsx)(l.XCircle,{className:"w-4 h-4 mr-1"}),w===a.id?"...":"Reject"]})]})]},a.id))})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Approved / Attended"}),(0,b.jsx)(e.CardDescription,{children:"Complete after visit"})]}),(0,b.jsx)(e.CardContent,{children:0===N.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No approved/attended appointments"}):(0,b.jsx)("div",{className:"space-y-3",children:N.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-sm font-semibold text-primary",children:a.patients?.name?a.patients.name.charAt(0):"?"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:a.patients?.name||"Unknown Patient"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.date," at ",a.time]}),"attended"===a.status&&(0,b.jsx)("p",{className:"text-xs text-blue-600",children:"Patient marked as attended"})]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(f.Button,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>J(a),disabled:w===a.id,children:[(0,b.jsx)(k.CheckCircle,{className:"w-4 h-4 mr-1"}),w===a.id?"...":"Complete"]})})]},a.id))})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Today's Schedule"}),(0,b.jsx)(e.CardDescription,{children:"Your confirmed appointments for today"})]}),(0,b.jsx)(e.CardContent,{children:0===O.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No appointments today"}):(0,b.jsx)("div",{className:"space-y-3",children:O.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg",children:[(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:a.patients?.name||"Unknown Patient"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.time})]})}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"Confirmed"})})]},a.id))})})]})]}),A&&(0,b.jsx)(p.default,{open:y,onClose:()=>{z(!1),B(null)},onCollect:K,appointmentData:{patientName:A.patients?.name||"Unknown Patient",service:A.service||"Treatment",suggestedAmount:C}})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=app_dentist_dashboard_page_tsx_7d254102._.js.map